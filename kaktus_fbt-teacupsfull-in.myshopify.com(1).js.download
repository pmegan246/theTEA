var kaktusfbaseUrl="https://fbt.kaktusapp.com/";var kaktusfApiUrl="https://fbt.kaktusapp.com/";var kaktusfShop="teacupsfull-in.myshopify.com";var kaktusfTriggerEvents=[6];var kaktusfPageIds=[];var kaktusfCertainBtns=[];var kaktusfCurrencyCode="INR";var kaktusfCurrencySymbol="INR {{amount}}";var kaktusfUrl=window.location.href;var kaktusfVersion="136"
var kaktusfShowPopupAllPeriod=0;var kaktusfShowPopupPerDay=0;var kaktusfWhenPopupDisplayed=0;var kaktusfRemoveFunnelProducts=0;var kaktusfMaxShowOffer=0;var kaktusfTriggerButton="";var kaktusfbuyItNow="";var kaktusfCartButton="";var kaktusfInlineWidget="";var kaktusfInlineWidgetCartPage="";var kaktusfInlineWidgetThankYouPage="";var kaktusfInlineWidgetSelectedPage="";var kaktusfCartProductRow="";var kaktusfCartProductClass="";var kaktusfCartSubTotal="0";var kaktusfCartSubTotalContainer="";var kaktusfTranslations={"en":{"checkout_btn":"Add to Cart","discount_tag_text":"Save","total_text":"Total:","alert_before_text":"Alert before"}};if(!kaktusfApp){var kaktusfApp=function(){const noImage=kaktusfbaseUrl+'assets/images/no-image.jpg';let allowProducts=null;let closePopupNumber;let popupNumberCount=1;let funnelsObj=null;let allProducts;let allDiscounts;let widgetDesign;let maxQty=1;let currentProductId;let mainOfferId;let offerId;let purchaseData=[];let orderData=[];let countDown=null;let replaceEvent=1;let statisticArr=[];let iframe;let maxProductNumber;let currentProductNumber=0;let productsData=[];let excludeOffers=[];let goToCheckoutAction=false;let currentTriggerType=0;let triggerProduct=false;let allowPageReload=false;let pageReload=false;let cartOfferExcludeId;const currentLocale=Shopify.locale;const appContainerClass='.kaktusf-app-container';let facebookId=null;let googleId=null;let pinterestId=null;let snapId=null;let snapEmail=null;let sliderAutoplay;const sliderDelay=5000;const offerTypes={crossSell:1,upsell:2,bundle:3,postPurchase:4,discount:5,frequentlyBoughtTogether:6,homePage:8,exitIntent:7,cartPage:9,beforeCheckout:10,slider:11,bundleByProduct:13,bundleComboProducts:14,bundleBuilder:15,fbt:16}
const triggerTypes={addToCart:'1',cartPage:'2',thankYouPage:'3',selectedPages:'4',certainButtons:'5',productPage:'6',exitIntent:'7',homePage:'8',collectionPage:'9',blogPage:'10',beforeCheckout:'11',buyItNow:'12'}
const popupTypes={popup:'1',float_popup:'2',inline:'3'}
const inlineWidgetPosition={before:'1',after:'2'}
if(Shopify.designMode){buildPreviewContainer();}
function cartPageDiscount(){let defaultSubTotalPriceClass=['.cart-subtotal__price','.totals__subtotal-value'];let settingSubTotalPriceClass=kaktusfCartSubTotal.length&&kaktusfCartSubTotal!='0'?decodeHTML(kaktusfCartSubTotal).split(','):[];let defaultSubTotalContainerClass=['.cart-subtotal','.totals'];let settingSubTotalContainerClass=kaktusfCartSubTotalContainer.length?decodeHTML(kaktusfCartSubTotalContainer).split(','):[];let defaultSubTotalProductRowClass=[];let settingSubTotalProductRowClass=kaktusfCartProductRow.length?decodeHTML(kaktusfCartProductRow).split(','):[];let defaultSubTotalProductPriceClass=[];let settingSubTotalProductPriceClass=kaktusfCartProductClass.length?decodeHTML(kaktusfCartProductClass).split(','):[];const subTotalPrice=getDOMSelector(defaultSubTotalPriceClass,settingSubTotalPriceClass);const subTotalContainer=getDOMSelector(defaultSubTotalContainerClass,settingSubTotalContainerClass);const subTotalProductRow=getDOMSelectorClass(defaultSubTotalProductRowClass,settingSubTotalProductRowClass);const subTotalProductPrice=getDOMSelectorClass(defaultSubTotalProductPriceClass,settingSubTotalProductPriceClass);if(!subTotalPrice||!subTotalContainer)return;const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));if("/cart"===location.href.slice(-5)&&localDataOrder){setTimeout(()=>{runCartPageDiscount();},700);}
function runCartPageDiscount(){const kaktusbotCartContainer=document.querySelector(`.kaktus-cart-container`);if(kaktusbotCartContainer){subTotalPrice.style.textDecoration='';kaktusbotCartContainer.remove();}
const isDiscount=localDataOrder.find(product=>product.discountValue!=null);if(!isDiscount)return;fetchCart().then(function(dataCart){const{total_price,items}=dataCart;if(items.length){if(document.querySelector(subTotalProductRow)){let totalDiscountPrice=buildDiscountProductContainer(localDataOrder,items);buildDiscountContainer(total_price,totalDiscountPrice);}else{let totalDiscountPrice=calcDiscountPrice(localDataOrder,items);buildDiscountContainer(total_price,totalDiscountPrice);}}});}
function calcDiscountPrice(localDataOrder,items){let totalDiscountPrice=0;items.forEach(productItem=>{const lineItemProperty=localDataOrder.find(product=>product.propertyId===productItem.properties.offer);if(lineItemProperty!==undefined){let productPrice=productItem.discounted_price / 100;const discountAll=+productPrice*(+lineItemProperty.discountValue / 100).toFixed(2)
productPrice=(+productPrice-(+productPrice*+lineItemProperty.discountValue / 100)).toFixed(2);totalDiscountPrice+=discountAll*lineItemProperty.qty;}})
return totalDiscountPrice;}
function buildDiscountProductContainer(localDataOrder,items){let arr=[];let totalDiscountPrice=0;let arrProducts=[];items.forEach(productItem=>{const lineItemProperty=localDataOrder.find(product=>product.propertyId===productItem.properties.offer);const shopifyRate=window.Shopify.currency.rate;arrProducts.push(lineItemProperty);if(lineItemProperty!==undefined){let productPrice=productItem.discounted_price / 100;let discountAll=+productPrice*(+lineItemProperty.discountValue / 100).toFixed(2)
if(lineItemProperty.discountType!='%'&&lineItemProperty.discountType){discountAll=(+lineItemProperty.discountValue*shopifyRate).toFixed(2)}
if(lineItemProperty.qty===productItem.quantity||lineItemProperty.qty>productItem.quantity){totalDiscountPrice+=discountAll*lineItemProperty.qty;let productPriceNew=(+productPrice-(+productPrice*+lineItemProperty.discountValue / 100)).toFixed(2);if(lineItemProperty.discountType!='%'&&lineItemProperty.discountType){productPriceNew=productPrice-(+lineItemProperty.discountValue*shopifyRate).toFixed(2)}
arr.push(productPriceNew*lineItemProperty.qty);}else{const diffQty=+productItem.quantity-(+lineItemProperty.qty);productPriceDiscounted=(+productPrice-(+productPrice*+lineItemProperty.discountValue / 100)).toFixed(2);if(lineItemProperty.discountType!='%'&&lineItemProperty.discountType){productPriceDiscounted=(+lineItemProperty.discountValue*shopifyRate).toFixed(2);arr.push((productPrice-productPriceDiscounted)*(lineItemProperty.qty+diffQty));totalDiscountPrice+=discountAll*(lineItemProperty.qty);}else{totalDiscountPrice+=discountAll*lineItemProperty.qty;arr.push((productPriceDiscounted*lineItemProperty.qty)+(productItem.discounted_price / 100*diffQty));}}}else{arr.push(null);}})
const cart_products=document.querySelectorAll(subTotalProductRow);cart_products.forEach((product,id)=>{const flagItem=arrProducts[id].discountValue??arrProducts[id].discountValue;if(arr[id]!==null&&arr[id]!=='0.0000'&&flagItem){const price_wrap=product.querySelector(subTotalProductPrice);const discounted_price=arr[id];if(currencyRemoveIcon(price_wrap.innerText)==discounted_price)return;price_wrap.style.textDecoration='line-through';const html=`
                            <p style="margin: 0 0 10px 0;">${currencyFormat(discounted_price )}</p>
                        `;const element=document.createElement("div");element.innerHTML=html;price_wrap.after(element);}})
return totalDiscountPrice;}
function buildDiscountContainer(totalPrice,totalDiscount){if(totalDiscount==0)return;const totalDiscountPrice=(totalPrice-(totalDiscount*100))/ 100;const html=`
                    <p style="margin: 0 0 10px 0;">- ${currencyFormat(totalDiscount)}</p>
                    <p style="margin: 0; font-size: 1.4rem;">${currencyFormat(totalDiscountPrice)}</p>
                `;const element=document.createElement("div");element.classList.add("kaktus-cart-container");element.style.textAlign='right';element.innerHTML=html;subTotalContainer.after(element);subTotalPrice.style.textDecoration='line-through';}}
cartPageDiscount();let kaktusfCurrencySymbolNew=kaktusfCurrencySymbol=="&amp;euro;{{amount}}"?'€{{amount}}':kaktusfCurrencySymbol;kaktusfCurrencySymbol=decodeHTML(kaktusfCurrencySymbolNew.replace(/(<([^>]+)>)/ig,""));const currentCurrencyCode=Shopify.currency.active;let currentCurrencySymbol=kaktusfCurrencySymbol;let currencyRate=1;if(kaktusfCurrencyCode!==currentCurrencyCode){const country=Shopify.country;currencyRate=Shopify.currency.rate;const regexStr=`[${getMainCurrencySymbol()}]`;const regex=new RegExp(regexStr,'g')
currentCurrencySymbol=kaktusfCurrencySymbol.replace(regex,getCurrencySymbol(country,currentCurrencyCode));}
function getCurrencySymbol(locale,currency){return(0).toLocaleString(locale.toLowerCase(),{style:'currency',currency:currency,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,'').trim()}
function getMainCurrencySymbol(){if(kaktusfCurrencySymbol.includes('{{')){return kaktusfCurrencySymbol.replace(/{{(.*?)}}/ig,'').trim();}else{return kaktusfCurrencySymbol.trim();}}
function getPriceByRate(price){return(parseFloat(price)*currencyRate).toFixed(2);}
function getStorePriceByRate(price){return(parseFloat(price)/ currencyRate).toFixed(2);}
function currencyFormat(num){if(!num){return currentCurrencySymbol.replace(/{{(.*?)}}/ig,'');}
if(currentCurrencySymbol.includes('{{')){return currentCurrencySymbol.replace(/{{(.*?)}}/ig,formatNumber(num));}else{return currentCurrencySymbol+formatNumber(num);}}
function formatNumber(num){num=parseFloat(num).toFixed(2);return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,");}
function currencyRemoveIcon(string){let icon=kaktusfCurrencySymbol.replace('{{amount}}','');let line=string.replace(icon,'');return Number(line);}
function decodeHTML(html){const txt=document.createElement('textarea');txt.innerHTML=html;return txt.value;};let slideUp=(target,duration=500)=>{target.style.transitionProperty='height, margin, padding';target.style.transitionDuration=duration+'ms';target.style.boxSizing='border-box';target.style.height=target.offsetHeight+'px';target.offsetHeight;target.style.overflow='hidden';target.style.height=0;target.style.paddingTop=0;target.style.paddingBottom=0;target.style.marginTop=0;target.style.marginBottom=0;window.setTimeout(()=>{target.style.display='none';target.style.removeProperty('height');target.style.removeProperty('padding-top');target.style.removeProperty('padding-bottom');target.style.removeProperty('margin-top');target.style.removeProperty('margin-bottom');target.style.removeProperty('overflow');target.style.removeProperty('transition-duration');target.style.removeProperty('transition-property');},duration);}
let slideDown=(target,duration=500)=>{target.style.removeProperty('display');let display=window.getComputedStyle(target).display;if(display==='none')display='flex';target.style.display=display;let height=target.offsetHeight;target.style.overflow='hidden';target.style.height=0;target.style.paddingTop=0;target.style.paddingBottom=0;target.style.marginTop=0;target.style.marginBottom=0;target.offsetHeight;target.style.boxSizing='border-box';target.style.transitionProperty="height, margin, padding";target.style.transitionDuration=duration+'ms';target.style.height=height+'px';target.style.removeProperty('padding-top');target.style.removeProperty('padding-bottom');target.style.removeProperty('margin-top');target.style.removeProperty('margin-bottom');window.setTimeout(()=>{target.style.removeProperty('height');target.style.removeProperty('overflow');target.style.removeProperty('transition-duration');target.style.removeProperty('transition-property');},duration);}
function setCookieData(){let url=location.href;const kaktusfCurrentShownPerMonth=getCookie('kaktusfCurrentShownPerMonth');const kaktusfCurrentShownPerDay=getCookie('kaktusfCurrentShownPerDay');const ZERO=0;const oneMonth=new Date(Date.now()+3600000*24*25);const oneWeek=new Date(Date.now()+3600000*24*7);const oneDay=new Date(Date.now()+3600000*24);let currentDate=new Date(Date.now());currentDate=currentDate.toUTCString();if(url.includes('#')){url=url.split('#');if(url[url.length-1]){let parameter='#'+url[url.length-1];setCookie('kaktusfUrl',parameter,{expires:oneWeek});}}
if(!kaktusfCurrentShownPerMonth){setCookie('kaktusfCurrentShownPerMonth',ZERO,{expires:oneMonth});setCookie('kaktusfStartDatePerMonth',currentDate,{expires:oneMonth});}
if(!kaktusfCurrentShownPerDay){setCookie('kaktusfCurrentShownPerDay',ZERO,{expires:oneDay});setCookie('kaktusfStartDatePerDay',currentDate,{expires:oneDay});}}
setCookieData();function setCookie(name,value,options={}){options={path:'/',...options};if(options.expires instanceof Date){options.expires=options.expires.toUTCString();}
let updatedCookie=encodeURIComponent(name)+"="+encodeURIComponent(value);for(let optionKey in options){updatedCookie+="; "+optionKey;let optionValue=options[optionKey];if(optionValue!==true){updatedCookie+="="+optionValue;}}
document.cookie=updatedCookie;}
function getCookie(name){let matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,'\\$1')+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):undefined;}
function buildPopUpType(dataOffer,dataCart,currentProductId,triggerType){const popUpType=(dataOffer.offers[Object.keys(dataOffer.offers)[0]].popup_type).toString();clearPreviewContainer();switch(popUpType){case popupTypes.popup:buildPopUp(dataOffer,dataCart,currentProductId,triggerType);break;case popupTypes.float_popup:buildMiniPopUp(dataOffer,dataCart,currentProductId,triggerType);break;case popupTypes.inline:buildInlineWidget(dataOffer,dataCart,currentProductId,triggerType);break;}
socialPixel();}
function buildMiniPopUp(dataOffer,dataCart,currentProductId,triggerType){let popupShow=isPopupShown();if(!popupShow)return;const floatTypeId=dataOffer.offers[Object.keys(dataOffer.offers)[0]].float_type;const floatTypes={btn_icon:'1',btn_title:'2'};const float_position=dataOffer.offers[Object.keys(dataOffer.offers)[0]].float_position;removeAppContainer();buildIframe();setMiniFrame();document.getElementById('kaktusf-widget').onload=function(){iframe=document.getElementById('kaktusf-widget');buildMiniContainer(dataOffer,dataCart,currentProductId,triggerType);}
function setMiniFrame(){const kaktusfContainer=document.getElementById('kaktusf-app');kaktusfContainer.style.opacity='0';kaktusfContainer.style.height='auto';kaktusfContainer.style.width='400px';kaktusfContainer.style.borderRadius='2px';kaktusfContainer.style.overflow='hidden';kaktusfContainer.style.margin='20px';switch(float_position){case"top_left":kaktusfContainer.style.bottom='auto';kaktusfContainer.style.right='auto';kaktusfContainer.style.top='0';kaktusfContainer.style.left='0';break;case"top_right":kaktusfContainer.style.bottom='auto';kaktusfContainer.style.right='0';kaktusfContainer.style.top='0';kaktusfContainer.style.left='auto';break;case"bottom_left":kaktusfContainer.style.bottom='0';kaktusfContainer.style.right='auto';kaktusfContainer.style.top='auto';kaktusfContainer.style.left='0';break;case"bottom_right":kaktusfContainer.style.bottom='0';kaktusfContainer.style.right='0';kaktusfContainer.style.top='auto';kaktusfContainer.style.left='auto';break;}
if(window.innerWidth<440){kaktusfContainer.style.width='100%';kaktusfContainer.style.margin='0';}}
function buildMiniContainer(dataOffer,dataCart,currentProductId,triggerType){let html='';switch(floatTypeId){case floatTypes.btn_icon:html=btnIconType();break;case floatTypes.btn_title:html=btnTitleType();break;}
const element=document.createElement("div");element.classList.add("kaktusf-minimize");element.innerHTML=html;const rootDiv=iframe.contentWindow.document.getElementById('kaktusf-root');rootDiv.append(element);setMiniPopUpStyle(dataOffer,rootDiv);buttonEvent(rootDiv,dataOffer,dataCart,currentProductId,triggerType)}
function btnIconType(){return html=`
                <div class="kaktusf-minimize__btn kaktusf-minimize__btn-icon">
                    <svg class="kaktusf-minimize_icon" width="30" height="34" viewBox="0 0 89 93" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M33.7895 12.1541C30.579 8.46328 29.68 5.93798 23.9653 1.72913C17.6085 1.72913 5.98642 13.3844 9.90326 19.6005C17.0306 27.824 44.641 28.6658 48.301 28.083C48.7505 27.3707 36.0369 14.9384 33.7895 12.1541Z" fill="#20262F"/>
                        <path d="M64.9216 2.28125C59.1957 6.49792 58.2306 9.06746 55.0782 12.8888C52.8264 15.7219 40.0235 28.4378 40.6025 29.1625C44.2054 29.8214 71.9342 28.899 79.0112 20.5315C82.8713 14.1406 71.2908 2.34714 64.9216 2.28125Z" fill="#20262F"/>
                        <path d="M31.9865 12.826C29.226 9.67917 28.4531 7.52604 23.5396 3.9375C18.074 3.9375 8.08125 13.875 11.449 19.175C17.5771 26.1865 41.3167 26.9042 44.4635 26.4073C44.85 25.8 33.9188 15.2 31.9865 12.826Z" fill="#EAA700"/>
                        <path d="M30.922 11.3906C28.9319 8.43414 27.6095 6.69792 23.4553 3.9375C17.3961 3.9375 12.0575 13.1832 14.5451 18.0749C19.0681 24.5791 36.5718 25.2779 38.8785 24.7941C41.9637 20.224 32.3241 13.5945 30.922 11.3906Z" fill="#FFBD18"/>
                        <path d="M64.8197 4.4895C59.9061 8.02284 59.078 10.176 56.3728 13.378C54.4405 15.752 43.454 26.4072 43.9509 27.0145C47.0426 27.5666 70.8374 26.7937 76.9103 19.7822C80.2228 14.427 70.2853 4.54471 64.8197 4.4895Z" fill="#FFBD18"/>
                        <path d="M78.3989 31.5416H9.94448C6.14784 31.5416 3.0415 34.6676 3.0415 38.4882V84.22C3.0415 88.0407 6.14784 91.1666 9.94448 91.1666H78.3989C82.1956 91.1666 85.3019 88.0407 85.3019 84.22V38.4882C85.3019 34.6676 82.1956 31.5416 78.3989 31.5416Z" fill="#20262F"/>
                        <path d="M77.0207 32.6458H11.3228C7.679 32.6458 4.69775 35.627 4.69775 39.2708V82.8853C4.69775 86.5291 7.679 89.5103 11.3228 89.5103H77.0207C80.6644 89.5103 83.6457 86.5291 83.6457 82.8853V39.2708C83.6457 35.627 80.6644 32.6458 77.0207 32.6458Z" fill="#D92B07"/>
                        <path d="M83.5891 40.375H12.4832C12.4832 40.5546 12.4268 40.6744 12.4268 40.854V83.0623C12.4268 86.5946 15.0791 89.4684 18.4087 89.4684H76.1924C81.5535 89.8874 83.6455 87.1334 83.6455 83.0623V40.854C83.6455 40.6744 83.5891 40.5546 83.5891 40.375Z" fill="#F82A00"/>
                        <path d="M53.8332 38.7188H34.5103V89.5104H53.8332V38.7188Z" fill="#20262F"/>
                        <path d="M52.1769 38.7188H36.1665V89.5104H52.1769V38.7188Z" fill="#FFBD18"/>
                        <path d="M50.1401 14.9791H38.2037C36.4446 14.9791 35.0625 16.3736 35.0625 18.1485V28.9243C35.0625 30.6992 36.4446 32.0937 38.2037 32.0937H50.1401C51.8991 32.0937 53.2813 30.6992 53.2813 28.9243V18.1485C53.2813 16.3736 51.8991 14.9791 50.1401 14.9791Z" fill="#20262F"/>
                        <path d="M36.7188 18.8437C36.7188 17.6241 37.7075 16.6354 38.9271 16.6354H49.4167C50.6363 16.6354 51.625 17.6241 51.625 18.8437V30.4375C51.625 31.6571 50.6363 32.6458 49.4167 32.6458H38.9271C37.7075 32.6458 36.7188 31.6571 36.7188 30.4375V18.8437Z" fill="#FFBD18"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.38525 40.9271V33.198C1.38525 29.223 4.3665 26.0209 8.01025 26.0209H80.8853C84.529 26.0209 87.5103 29.223 87.5103 33.198V40.9271H1.38525Z" fill="#20262F"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.0415 39.2709V33.2593C3.0415 30.1676 5.90809 27.6771 9.4117 27.6771H79.4838C82.9874 27.6771 85.854 30.1676 85.854 33.2593V39.2709H3.0415Z" fill="#D92B07"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M12.4272 39.1605V33.198C12.4272 30.1615 14.9668 27.6771 18.0585 27.6771H80.2783C83.7012 27.4011 85.8543 30.2719 85.9095 33.198V39.1605H12.4272Z" fill="#F82A00"/>
                    </svg>
                    <span class="kaktusf-btn-text"></span>
                </div>
            `;}
function btnTitleType(){const html=`
                <div class="kaktusf-minimize__top">
                    <h2 class="kaktusf-minimize__title"></h2>

                    <div class="kaktusf-countdown">
                        <div class="kaktusf-countdown__wrap">
                            <div class="kaktusf-countdown__msg"></div>
                            <div class="kaktusf-countdown__time"></div>
                        </div>
                    </div>

                </div>
                <div class="kaktusf-minimize__btn"><span class="kaktusf-btn-text"></span></div>
            `;return html}
function setMiniPopUpStyle(dataOffer,rootDiv){const kaktusfApp=document.getElementById('kaktusf-app');const data={title:dataOffer.offers[Object.keys(dataOffer.offers)[0]].title,timer_show:dataOffer.offers[Object.keys(dataOffer.offers)[0]].allow_timer,timer_minutes:dataOffer.offers[Object.keys(dataOffer.offers)[0]].timer_minutes,timer_seconds:dataOffer.offers[Object.keys(dataOffer.offers)[0]].timer_seconds,timer_text:dataOffer.offers[Object.keys(dataOffer.offers)[0]].timer_text,timer_bg:dataOffer.design.main.timer_bg,timer_border_radius:dataOffer.design.main.timer_border_radius,timer_color:dataOffer.design.main.timer_color,btn_bg:dataOffer.design.widget_type===11?dataOffer.design.product.cart_btn_bg:dataOffer.design.bottom.checkout_btn_bg,btn_font_color:dataOffer.design.widget_type===11?dataOffer.design.product.cart_btn_font_color:dataOffer.design.bottom.checkout_btn_font_color,btn_text:dataOffer.offers[Object.keys(dataOffer.offers)[0]].float_btn_text}
const btn=rootDiv.querySelector('.kaktusf-minimize__btn');const btnText=rootDiv.querySelector('.kaktusf-btn-text');btnText.innerText=data.btn_text;btn.style.background=data.btn_bg;btn.style.color=data.btn_font_color;switch(floatTypeId){case floatTypes.btn_icon:const miniContainerWidth=rootDiv.querySelector('.kaktusf-minimize__btn').offsetWidth;kaktusfApp.style.width=`${miniContainerWidth}px`;kaktusfApp.style.borderRadius=`50px`;break;case floatTypes.btn_title:const title=rootDiv.querySelector('.kaktusf-minimize__title');const timerText=rootDiv.querySelector('.kaktusf-countdown__msg');const timerDiv=rootDiv.querySelector('.kaktusf-countdown');title.innerText=data.title;if(data.timer_show){timerText.innerText=data.timer_text;timerDiv.style.background=data.timer_bg;timerDiv.style.borderRadius=data.timer_border_radius;timerDiv.style.color=data.timer_color;const timerDisplay=rootDiv.querySelector('.kaktusf-countdown__time');buildTimer(data.timer_minutes,data.timer_seconds,timerDisplay);startTimer(true,data.timer_minutes,data.timer_seconds,timerDisplay);}else{timerDiv.remove();}
break;}
const miniContainerHeight=rootDiv.querySelector('.kaktusf-minimize').offsetHeight;kaktusfApp.style.height=`${miniContainerHeight}px`;kaktusfApp.style.opacity='1';}
function buttonEvent(rootDiv,dataOffer,dataCart,currentProductId,triggerType){const btn=rootDiv.querySelector('.kaktusf-minimize__btn');btn.addEventListener("click",function(e){e.preventDefault();removeAppContainer();buildPopUp(dataOffer,dataCart,currentProductId,triggerType);})}}
function buildInlineWidget(dataOffer,dataCart,targetProductId,triggerType){let nodeElement=null;nodeElement=getInlineNode(triggerType);function getInlineNode(triggerType){let defaultNodeElements=[];let inlineWidgetArr=[];switch(triggerType){case triggerTypes.cartPage:defaultNodeElements=[appContainerClass,'cart-items','form[action*="/cart"]'];inlineWidgetArr=kaktusfInlineWidgetCartPage.length?decodeHTML(kaktusfInlineWidgetCartPage).split(','):inlineWidgetArr;break;case triggerTypes.productPage:defaultNodeElements=[appContainerClass,'form[action*="/cart/add"]'];inlineWidgetArr=kaktusfInlineWidget.length?decodeHTML(kaktusfInlineWidget).split(','):inlineWidgetArr;break;case triggerTypes.selectedPages:defaultNodeElements=[appContainerClass,'.kaktusf-container'];inlineWidgetArr=kaktusfInlineWidgetSelectedPage.length?decodeHTML(kaktusfInlineWidgetSelectedPage).split(','):inlineWidgetArr;break;case triggerTypes.thankYouPage:defaultNodeElements=[appContainerClass,'.section__header'];inlineWidgetArr=kaktusfInlineWidgetThankYouPage.length?decodeHTML(kaktusfInlineWidgetThankYouPage).split(','):inlineWidgetArr;break;}
const commonInlineWidgetArr=inlineWidgetArr.concat(defaultNodeElements);const uniqueInlineWidgetArr=[...new Set(commonInlineWidgetArr)];if(uniqueInlineWidgetArr.length){for(let i=0;i<uniqueInlineWidgetArr.length;i++){const itemTrim=uniqueInlineWidgetArr[i].trim();const currentNode=document.querySelector(itemTrim);if(currentNode!=null){return currentNode;}}}else{return null;}}
if(!nodeElement)return;const isSylesheet=document.querySelector('link#KaktusFbtCss');if(!isSylesheet){styleLoader();}
buildInlineContainer();function styleLoader(){const headID=document.getElementsByTagName('head')[0];const link=document.createElement('link');link.type='text/css';link.id='KaktusFbtCss'
link.rel='stylesheet';headID.appendChild(link);link.href=kaktusfbaseUrl+`css/kaktus-fbt.css?v=${kaktusfVersion}`;};function buildInlineContainer(){const insertPosition=(dataOffer.offers[Object.keys(dataOffer.offers)[0]].inline_position).toString();const element=document.createElement("div");element.setAttribute("id","kaktusf-app");element.style.width='100%';element.style.margin='20px 0';element.style.fontFamily='inherit';element.style.display='none';if(insertPosition===inlineWidgetPosition.before){nodeElement.before(element);}else{nodeElement.after(element);}}
const offerType=dataOffer.offers[Object.keys(dataOffer.offers)[0]].offer_type;switch(offerType){case offerTypes.bundle:case offerTypes.bundleByProduct:case offerTypes.bundleBuilder:case offerTypes.frequentlyBoughtTogether:cartOfferExcludeId=dataOffer.main_offer_id;buildBundleInline(dataOffer,dataCart,targetProductId);break;case offerTypes.fbt:if(dataOffer.design.design_type.layout==="fbt"){cartOfferExcludeId=dataOffer.main_offer_id;buildFbtInline(dataOffer,dataCart,targetProductId);}else{cartOfferExcludeId=dataOffer.main_offer_id;buildBundleInline(dataOffer,dataCart,targetProductId);};break;case offerTypes.bundleComboProducts:cartOfferExcludeId=dataOffer.main_offer_id;buildBundleInline(dataOffer,dataCart,targetProductId);removeShopifyForm();break;}}
function buildPopUp(dataOffer,dataCart,targetProductId,triggerType){let popupShow=isPopupShown();if(!popupShow)return;increasePopupShown();disabledPageScroll();pageReload=false;cartOfferExcludeId=dataOffer.main_offer_id;let kaktusfPopup=document.querySelector("#kaktusf-app");if(kaktusfPopup){kaktusfPopup.remove();}
const offerType=dataOffer.offers[Object.keys(dataOffer.offers)[0]].offer_type;buildIframe();createOffersData(dataOffer.main_offer_id);document.getElementById('kaktusf-widget').onload=function(){iframe=document.getElementById('kaktusf-widget');switch(offerType){case offerTypes.bundle:case offerTypes.frequentlyBoughtTogether:case offerTypes.bundleByProduct:case offerTypes.fbt:buildBundle(dataOffer,dataCart,targetProductId);break;}};}
function buildIframe(){const html=`<iframe id="kaktusf-widget" style="width: 100% !important; height: 100% !important" frameborder="0" srcdoc='<!DOCTYPE html><html><head><link type="text/css" rel="stylesheet" href="${kaktusfbaseUrl}css/kaktus-fbt.css?v=${kaktusfVersion}"></head><body><div id="kaktusf-root"></div></body></html>'></iframe>`;const element=document.createElement("div");element.setAttribute("id","kaktusf-app");element.innerHTML=html;element.style.height='100%';element.style.width='100%';element.style.position='fixed';element.style.top='0';element.style.left='0';element.style.zIndex='99999999999999999';document.querySelector('body').append(element);}
function disabledPageScroll(){document.querySelector('body').style.overflow='hidden';document.querySelector('body').style.height='100%';document.querySelector('html').style.overflow='hidden';document.querySelector('html').style.height='100%';}
function removeAppContainer(){clearInterval(sliderAutoplay);const kaktusfPopup=document.querySelector("#kaktusf-app");iframe=null;if(kaktusfPopup){kaktusfPopup.remove();}
document.querySelector('body').style.overflow='';document.querySelector('body').style.height='';document.querySelector('html').style.overflow='';document.querySelector('html').style.height='';}
function buildPreviewContainer(){const rootDiv=document.querySelector(appContainerClass);if(!rootDiv)return;const html='<span>The <b>Kaktus APP</b> will be displayed here!</span>';const element=document.createElement("div");element.classList.add('kaktusb-app-preview');element.style.padding='20px';element.style.border='1px solid #e4e4e4';element.style.borderRadius='8px';element.style.textAlign='center';element.innerHTML=html;rootDiv.append(element);}
function clearPreviewContainer(){const previewContainer=document.querySelector(appContainerClass);if(previewContainer){previewContainer.innerHTML='';}}
function getAppSelector(element){return iframe?iframe.contentWindow.document.querySelector(element):document.querySelector(element);}
function getAppSelectorAll(element){return iframe?iframe.contentWindow.document.querySelectorAll(element):document.querySelectorAll(element);}
function getOfferData(dataOffer){const data=dataOffer.offers[Object.keys(dataOffer.offers)[0]];return{offer_type:data.offer_type,id:data.id,auto_close_popup:data.auto_close_popup,accepted_click_add_to_cart:data.accepted_click_add_to_cart,accepted_click_checkout:data.accepted_click_checkout,decline_click_close:data.decline_click_close,decline_click_reject:data.decline_click_reject,close_btn_event:data.close_btn_event,reject_btn_event:data.reject_btn_event,reject_specific_url:data.reject_specific_url,checkout_btn_event:data.checkout_btn_event,specific_url:data.specific_url,disable_checkout_btn:data.disable_checkout_btn,go_to_checkout_action:data.go_to_checkout_action,replace_btn_event:data.replace_btn_event,max_products_number:data.max_products_number,allow_select_more_products:data.allow_select_more_products,auto_close_quantity:data.auto_close_quantity,max_quantity:data.max_quantity,reload_page:data.reload_page,child:data.child,bundle_min_qty:data.bundle_min_qty,popup_type:data.popup_type}}
function buildBundle(dataOffer,dataCart,targetProductId){const offerObj=getOfferData(dataOffer);mainOfferId=dataOffer.main_offer_id;offerId=offerObj.id;const offerTexts=getOfferTexts(dataOffer,dataOffer.offers[Object.keys(dataOffer.offers)[0]]);let targetProduct=targetProductId?dataCart.items.find(element=>element.id===+targetProductId):'';allowPageReload=offerObj.reload_page?true:false;const copyright=true?'':'<div class="kaktusf-copyright"><a href="https://kaktusapp.com/" target="_blank">Powered by Kaktus</a></div>';const html=`
                <div class="kaktusf-popup__wrap">
                    <div class="kaktusf-popup__body kaktusf-bd">
                        <div class="kaktusf-popup__close kaktusf-close" data-close="${offerObj.close_btn_event}">
                            <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" width="20" height="20" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512">
                                <path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path>
                            </svg>
                        </div>
                        <div class="kaktusf-popup__top kaktusf-bg-top">
                            <div class="kaktusf-popup__cart-alert kaktusf-hide">
                                <div class="kaktusf-before-alert kaktusf-alert-text"></div>
                                <div class="kaktusf-popup__cart-alert--img"></div>
                                <div class="kaktusf-alert-prod">«<span></span>»</div>
                            </div>
                        </div>

                        <div class="kaktusf-popup__main kaktusf-bg-main">
                            <div class="kaktusf-countdown kaktusf-timer">
                                <div class="kaktusf-countdown__wrap">
                                    <div class="kaktusf-countdown__msg kaktusf-timer-msg"></div>
                                    <div class="kaktusf-countdown__time"></div>
                                </div>
                            </div>

                            <div class="kaktusf-popup__main--wrapper kaktusf-wallpaper" style="display: none; z-index: -1;"></div>

                            <div class="kaktusf-popup__products">
                                <div class="kaktusf-popup__heading kaktusf-bg-heading">
                                    <h2 class="kaktusf-popup__title kaktusf-title"></h2>
                                    <p class="kaktusf-popup__description kaktusf-description"></p>
                                </div>
                                <section class="kaktusf-product__wrapp kaktusf-product--metro kaktusf-grid-item-2"></section>
                            </div>
                        </div>

                        <div class="kaktusf-popup__buttons kaktusf-bg-bottom">
                            <div class="kaktusf-popup__total--price">
                                <span class="kaktusf-total kaktusf-total-text"></span>
                                <span class="kaktusf-total-price"></span>
                            </div>

                            <a href="#" class="kaktusf-checkout-btn" data-checkout="${offerObj.checkout_btn_event}" data-redirect="${offerObj.specific_url}"></a>
                        </div>
                        ${copyright}
                    </div>

                    <style type="text/css" id="kaktusf-custom-css"></style>
                </div>
            `;const element=document.createElement("div");element.classList.add("kaktusf-popup","kaktusf-hide");element.innerHTML=html;const rootDiv=iframe.contentWindow.document.getElementById('kaktusf-root');rootDiv.append(element);const offer_data=dataOffer.offers[Object.keys(dataOffer.offers)[0]];const product_data=offer_data.products;for(let key in product_data){if(product_data.hasOwnProperty(key)){for(const[i,value]of Object.entries(product_data[key])){const productArray=JSON.parse(JSON.stringify(dataOffer.products));const productId=value;const bundle_qty=Object.keys(dataOffer.qtyData).length?dataOffer.qtyData[offer_data.id][productId]:1;const discount=dataOffer.discount[offer_data.id][key].discount;const discount_type=dataOffer.discount[offer_data.id][key].discount_type;productArray[value].discount_type=typeof discount_type!=undefined?discount_type:null;productArray[value].discount=typeof discount!=undefined?discount:null;productArray[value].bundle_qty=typeof bundle_qty!=undefined?bundle_qty:null;fillBundleProduct(productArray[value]);}}}
changeBundleTotalPrice();if(parseInt(offerObj.bundle_min_qty)>0){showActiveCheckbox();}
if(targetProduct){fillTargetProduct(targetProduct);}
toggleActiveProducts(element,offerObj.bundle_min_qty);actionBundle(element,offerObj.bundle_min_qty);setTranslation(dataOffer);buildWidget(dataOffer);changeWidgetText(element,offerTexts);}
function buildBundleInline(dataOffer,dataCart,targetProductId){const offerObj=getOfferData(dataOffer);mainOfferId=dataOffer.main_offer_id;offerId=offerObj.id;const offerTexts=getOfferTexts(dataOffer,dataOffer.offers[Object.keys(dataOffer.offers)[0]]);let targetProduct=targetProductId?dataCart.items.find(element=>element.id===+targetProductId):'';allowPageReload=offerObj.reload_page?true:false;const copyright=true?'':'<div class="kaktusf-copyright"><a href="https://kaktusapp.com/" target="_blank">Powered by Kaktus</a></div>';const html=`
                <div class="kaktusf-popup__body kaktusf-bd">
                    <div class="kaktusf-popup__main kaktusf-bg-main">
                        <div class="kaktusf-countdown kaktusf-timer">
                            <div class="kaktusf-countdown__wrap">
                                <div class="kaktusf-countdown__msg kaktusf-timer-msg"></div>
                                <div class="kaktusf-countdown__time"></div>
                            </div>
                        </div>

                        <div class="kaktusf-popup__main--wrapper kaktusf-wallpaper" style="display: none; z-index: -1;"></div>

                        <div class="kaktusf-popup__products">
                            <div class="kaktusf-popup__heading kaktusf-bg-heading">
                                <h2 class="kaktusf-popup__title kaktusf-title"></h2>
                                <p class="kaktusf-popup__description kaktusf-description"></p>
                            </div>
                            <section class="kaktusf-product__wrapp kaktusf-product--metro kaktusf-grid-item-2"></section>

                        </div>
                    </div>

                    <div class="kaktusf-popup__buttons kaktusf-bg-bottom">
                        <div class="kaktusf-popup__total--price">
                            <span class="kaktusf-total-text">Total:</span>
                            <span class="kaktusf-compare-price kaktusf-compare-total"></span>
                            <span class="kaktusf-total-price"></span>
                        </div>

                        <a href="#" class="kaktusf-checkout-btn" data-checkout="${offerObj.checkout_btn_event}" data-redirect="${offerObj.specific_url}"></a>
                    </div>
                    ${copyright}
                </div>

                <style type="text/css" id="kaktusf-custom-css"></style>
            `;const element=document.createElement("div");element.classList.add("kaktusf-inline");element.innerHTML=html;const rootDiv=document.getElementById('kaktusf-app');rootDiv.append(element);const offer_data=dataOffer.offers[Object.keys(dataOffer.offers)[0]];const product_data=offer_data.products;for(let key in product_data){if(product_data.hasOwnProperty(key)){for(const[i,value]of Object.entries(product_data[key])){const productArray=JSON.parse(JSON.stringify(dataOffer.products));const productId=value;const bundle_qty=Object.keys(dataOffer.qtyData).length?dataOffer.qtyData[offer_data.id][productId]:1;const discount=dataOffer.discount[offer_data.id][key].discount;const discount_type=dataOffer.discount[offer_data.id][key].discount_type;productArray[value].discount_type=typeof discount_type!=undefined?discount_type:null;productArray[value].discount=typeof discount!=undefined?discount:null;productArray[value].bundle_qty=typeof bundle_qty!=undefined?bundle_qty:null;fillBundleProduct(productArray[value],offerObj.popup_type);}}}
buildBundleASaleLabel(dataOffer,offer_data,rootDiv);changeBundleTotalPrice();changeBundleComparePrice();if(parseInt(offerObj.bundle_min_qty)>0){showActiveCheckbox();}
toggleActiveProducts(element,offerObj.bundle_min_qty);actionBundle(element,offerObj.bundle_min_qty);setTranslation(dataOffer);buildWidget(dataOffer);changeWidgetText(element,offerTexts);setTimeout(()=>{rootDiv.style.display='block';},500);}
function buildFbtInline(dataOffer,dataCart,targetProductId){const offerObj=getOfferData(dataOffer);mainOfferId=dataOffer.main_offer_id;offerId=offerObj.id;const offerTexts=getOfferTexts(dataOffer,dataOffer.offers[Object.keys(dataOffer.offers)[0]]);let targetProduct=targetProductId?dataCart.items.find(element=>element.id===+targetProductId):'';const totalText=dataOffer.design?dataOffer.design.translation?dataOffer.design.translation.total_btn:'':'';allowPageReload=offerObj.reload_page?true:false;const copyright=true?'':'<div class="kaktusf-copyright"><a href="https://kaktusapp.com/" target="_blank">Powered by Kaktus</a></div>';const html=`
                <div class="kaktusf-popup__body kaktusf-bd">
                    <div class="kaktusf-popup__main kaktusf-bg-main">
                        <div class="kaktusf-countdown kaktusf-timer">
                            <div class="kaktusf-countdown__wrap">
                                <div class="kaktusf-countdown__msg kaktusf-timer-msg"></div>
                                <div class="kaktusf-countdown__time"></div>
                            </div>
                        </div>

                        <div class="kaktusf-popup__main--wrapper kaktusf-wallpaper" style="display: none; z-index: -1;"></div>

                         <div class="kaktusf-popup__products">
                            <div class="kaktusf-popup__heading kaktusf-bg-heading">
                                <h2 class="kaktusf-popup__title kaktusf-title"></h2>
                                <p class="kaktusf-popup__description kaktusf-description"></p>
                            </div>
                        </div>

                        <div class="kaktusf-product__wrapp--img flex-c"></div>

                        <div class="kaktusf-popup__total--price flex-c">
                            <span class="kaktusf-total">${totalText}</span>
                            <span class="kaktusf-compare-price kaktusf-compare-total"></span>
                            <span class="kaktusf-total-price"></span>
                        </div>


                         <a href="#" class="kaktusf-checkout-btn" data-checkout="${offerObj.checkout_btn_event}" data-redirect="${offerObj.specific_url}">Checkout</a>

                       <section class="kaktusf-product__wrapp--fbt"></section>

                    </div>

                    <div class="kaktusf-popup__buttons kaktusf-bg-bottom">

                    </div>
                    ${copyright}
                </div>

                <style type="text/css" id="kaktusf-custom-css"></style>
            `;const element=document.createElement("div");element.classList.add("kaktusf-inline");element.innerHTML=html;const rootDiv=document.getElementById('kaktusf-app');rootDiv.append(element);const offer_data=dataOffer.offers[Object.keys(dataOffer.offers)[0]];const product_data=offer_data.products;for(let key in product_data){if(product_data.hasOwnProperty(key)){for(const[i,value]of Object.entries(product_data[key])){const productArray=JSON.parse(JSON.stringify(dataOffer.products));const productId=value;const bundle_qty=Object.keys(dataOffer.qtyData).length?dataOffer.qtyData[offer_data.id][productId]:1;const discount=dataOffer.discount[offer_data.id][key].discount;const discount_type=dataOffer.discount[offer_data.id][key].discount_type;productArray[value].discount_type=typeof discount_type!=undefined?discount_type:null;productArray[value].discount=typeof discount!=undefined?discount:null;productArray[value].bundle_qty=typeof bundle_qty!=undefined?bundle_qty:null;fillBundleProductImg(productArray[value],offerObj.popup_type);fillFbtProduct(productArray[value],offerObj.popup_type);}}}
buildBundleASaleLabel(dataOffer,offer_data,rootDiv);changeBundleTotalPrice();changeBundleComparePrice();if(parseInt(offerObj.bundle_min_qty)>0){showActiveCheckbox();}
toggleActiveProducts(element,offerObj.bundle_min_qty);actionFbt(element,offerObj.bundle_min_qty);setTranslation(dataOffer);buildWidget(dataOffer);changeWidgetText(element,offerTexts);setTimeout(()=>{rootDiv.style.display='block';},500);}
function setTranslation(dataOffer){const settingTexts=getSettingTexts(dataOffer);const dataTranslation={"checkout-btn-text":{value:"checkout_btn",element:"kaktusf-checkout-btn"},"total-text":{value:"total_text",element:"kaktusf-total-text"},"discount-tag-text":{value:"discount_tag_text",element:"kaktusf-save"},"alert-before-text":{value:"alert_before_text",element:"kaktusf-alert-text"},};for(let key in dataTranslation){const{value,element}=dataTranslation[key];const option=settingTexts[value];if(option==null)return;const nodeList=getAppSelectorAll('.'+element);nodeList.forEach((node)=>{node.innerText=option;});}}
function getSettingTexts(dataOffer){const defaultLocale=dataOffer.current_lang;const defaultLang=kaktusfTranslations[defaultLocale]||kaktusfTranslations[Object.keys(kaktusfTranslations)[0]];const currentLang=kaktusfTranslations[currentLocale]||defaultLang;return{'checkout_btn':currentLang.checkout_btn||defaultLang.checkout_btn,'total_text':currentLang.total_text||defaultLang.total_text,'discount_tag_text':currentLang.discount_tag_text||defaultLang.discount_tag_text,'alert_before_text':currentLang.alert_before_text||defaultLang.alert_before_text}}
function getOfferTexts(dataOffer,offerItem){const{translate}=offerItem;let data=translate[currentLocale]||offerItem;return{'title':data.title||offerItem.title,'allow_set_description':offerItem.allow_set_description,'description':data.description||offerItem.description,'timer_text':data.timer_text||offerItem.timer_text}}
function fillWidgetProduct(product,addToCartAccepted,triggerType,popup_type){const productTitle=product.title;const productDescription=product.description;let productImg=noImage;if(product.variants[0].image!=undefined){productImg=product.variants[0].image;}
let discount='';let productPrice=getPriceByRate(product.variants[0].variantPrice);let comparePrice='';let minQty=product.min_quantity?product.min_quantity:1;if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){let discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;discount=`
                    <div class="kaktusf-price--compare">
                        <span class="kaktusf-save-label">
                            <span class="kaktusf-save" data-discount="${discountVal}" data-discountType="${product.discount_type}"></span>

                            ${(product.discount_type === "%")
                                ? `<span class="kaktusf-price--compare-save">&nbsp;${Math.round(discountVal)}</span>${product.discount_type}`
                                : `<span class="kaktusf-price--compare-save">&nbsp;${currencyFormat(discountVal)}</span>`
                            }
                        </span>
                    </div>
                `;comparePrice=`<span class="kaktusf-price--compare-price kaktusf-compare-price">${currencyFormat(productPrice)}</span>`;if(product.discount_type==="%"){productPrice=(+productPrice-(+productPrice*+product.discount / 100));}else{productPrice=(+productPrice- +discountVal);}}
let variantsHtml='';if(product.variants.length>1){variantsHtml='<select class="kaktusf-variations">';for(let key in product.variants){let variantPrice=getPriceByRate(product.variants[key]['variantPrice']);if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){variantPrice=calcVariantsDiscountPrice(product,product.variants[key]);}
variantsHtml+=`
                    <option
                        value="${product.variants[key]['productId']}"
                        data-price="${getPriceByRate(product.variants[key]['variantPrice'])}"
                        data-store-price="${product.variants[key]['variantPrice']}"
                        data-compare-price="${getPriceByRate(product.variants[key]['variantComparePrice'])}"
                        data-diccounted-price="${variantPrice}"
                        data-image="${product.variants[key].image}"
                    >
                        ${product.variants[key]['title']} - ${currencyFormat(variantPrice)}
                    </option>
                `;}
variantsHtml+='</select>';}else{variantsHtml='';}
productPrice=currencyFormat(productPrice);const html=`
                <div class="kaktusf-product__content">
                    <div class="kaktusf-product__img">
                        <img class="kaktusf-product--img" src="${productImg}" alt="Product">
                    </div>
                    ${discount}

                    <div class="kaktusf-prod-det">
                        <h2 class="kaktusf-product__title kaktusf-prod-title">${productTitle}</h2>
                        <p class="kaktusf-prod-desc">
                            <span class="kaktusf-desc-short">${productDescription}</span>
                            <span class="kaktusf-desc-full kaktusf-hide">${productDescription}</span>
                        </p>

                        <div class="kaktusf-product__info--variations kaktusf-variations-wrap">
                            ${variantsHtml}
                        </div>
                    </div>
                </div>

                <div class="kaktusf-product__info kaktusf-product-bg">
                    <div class="kaktusf-product__info--top">
                        <div class="kaktusf-product__price">
                            <span class="kaktusf-price--main kaktusf-price">${productPrice}</span>
                            ${comparePrice}
                        </div>

                        <div class="kaktusf-product__quantity kaktusf-qty">
                            <div class="kaktusf-product__quantity--input">
                                <input class="kaktusf-qty-input" type="number" value="${minQty}" min="${minQty}">
                            </div>
                            <div class="kaktusf-product__quantity--actions">
                                <div class="kaktusf-product__quantity--plus kaktusf-qty-btn kaktusf-qty-btn-t">+</div>
                                <div class="kaktusf-product__quantity--minus kaktusf-qty-btn kaktusf-qty-btn-b">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="kaktusf-product__actions">
                        <a href="#" class="kaktusf-product__actions--btn kaktusf-cart-btn" data-productId="${product.variants[0].productId}" data-storePrice="${product.variants[0].variantPrice}">
                            <svg class="kaktusf-product-cart kaktusf-product-cart--active" xmlns="http://www.w3.org/2000/svg" width="19" height="20" viewBox="0 0 19 20">
                                <g>
                                    <g>
                                        <g>
                                            <path fill="inherit" d="M7.126 10h-.754c-.126 0-.227-.052-.252-.138l-1.887-4.62c-.05-.12.076-.242.252-.242h1.082a.35.35 0 0 1 .276.138l1.535 4.62c.05.12-.076.242-.252.242zm9.036 1.487l2.767-6.474c.279-.651-.299-1.322-1.115-1.322H3.702L2.906.553A.74.74 0 0 0 2.209 0H.24A.229.229 0 0 0 0 .237v.987c0 .138.1.237.239.237h1.234c.12 0 .199.078.239.177l3.204 12.81a.74.74 0 0 0 .697.552h10.45c.14 0 .239-.099.239-.237v-.967c0-.138-.1-.237-.24-.237H6.37c-.1 0-.199-.079-.238-.177l-.299-1.224h9.196c.517 0 .955-.276 1.134-.671z" />
                                        </g>
                                        <g>
                                            <path fill="inherit" d="M7.913 20c.875 0 1.584-.672 1.584-1.5S8.787 17 7.913 17c-.874 0-1.583.672-1.583 1.5S7.039 20 7.913 20z" />
                                        </g>
                                        <g>
                                            <path fill="inherit" d="M13.193 20c.875 0 1.584-.672 1.584-1.5s-.71-1.5-1.584-1.5c-.874 0-1.583.672-1.583 1.5s.709 1.5 1.583 1.5z" />
                                        </g>
                                    </g>
                                </g>
                            </svg>

                            <svg class="kaktusf-product-cart kaktusf-product-cart--added" width="22px" height="20px" viewBox="0 0 22 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                <g id="Page-1" stroke="none" stroke-width="1" fill-rule="evenodd">
                                    <g id="Group-17-Copy-3" transform="translate(-193.000000, -326.000000)" fill="inherit" fill-rule="nonzero">
                                        <g id="1" transform="translate(0.014493, 0.000000)">
                                            <g id="Price-Button" transform="translate(0.985507, 297.000000)">
                                                <g id="Button" transform="translate(176.000000, 20.000000)">
                                                    <g id="Icon-cart" transform="translate(16.000000, 9.000000)">
                                                        <path d="M2.20938167,0 C2.5278511,0 2.82641619,0.236842105 2.90603355,0.552631579 L2.90603355,0.552631579 L3.70220712,3.69078947 L3.70220712,3.69078947 L11.1433038,3.69057647 C11.0494838,4.11206178 11,4.55025211 11,5 C11,8.10583497 13.3598331,10.6605014 16.3842948,10.9687948 L16.1623236,11.4868421 C15.9831845,11.8815789 15.5452891,12.1578947 15.0277762,12.1578947 L15.0277762,12.1578947 L5.83197144,12.1578947 L6.13053653,13.3815789 C6.17034521,13.4802632 6.2698669,13.5592105 6.3693886,13.5592105 L6.3693886,13.5592105 L16.0628019,13.5592105 C16.2021323,13.5592105 16.3016539,13.6578947 16.3016539,13.7960526 L16.3016539,13.7960526 L16.3016539,14.7631579 C16.3016539,14.9013158 16.2021323,15 16.0628019,15 L16.0628019,15 L5.6130237,15 C5.29455427,15 4.99598918,14.7631579 4.91637183,14.4473684 L4.91637183,14.4473684 L1.71177319,1.63815789 C1.67196451,1.53947368 1.59234715,1.46052632 1.47292111,1.46052632 L1.47292111,1.46052632 L0.238852073,1.46052632 C0.0995216969,1.46052632 0,1.36184211 0,1.22368421 L0,1.22368421 L0,0.236842105 C0,0.0986842105 0.0995216969,0 0.238852073,0 L0.238852073,0 Z M5.56658802,5 L4.48494549,5 C4.30886415,5 4.18309176,5.12110727 4.23340071,5.24221453 L4.23340071,5.24221453 L6.11998652,9.8615917 C6.145141,9.94809689 6.24575891,10 6.3715313,10 L6.3715313,10 L7.12616562,10 C7.30224696,10 7.42801935,9.87889273 7.3777104,9.75778547 L7.3777104,9.75778547 L5.84328727,5.1384083 C5.79297832,5.06920415 5.69236041,5 5.56658802,5 L5.56658802,5 Z" id="Combined-Shape"></path>
                                                        <ellipse id="XMLID_198_" cx="7.91666667" cy="18.5" rx="1.58333333" ry="1.5"></ellipse>
                                                        <ellipse id="XMLID_200_" cx="13.1944444" cy="18.5" rx="1.58333333" ry="1.5"></ellipse>
                                                        <path d="M17,0 C19.7614237,0 22,2.23857625 22,5 C22,7.76142375 19.7614237,10 17,10 C14.2385763,10 12,7.76142375 12,5 C12,2.23857625 14.2385763,0 17,0 Z M19.4176707,2.52559727 L16.0533064,6.06605909 L14.5823251,4.51807609 C14.2619366,4.18093372 13.7424939,4.18093372 13.4221054,4.51809371 C13.1284313,4.82714089 13.1039443,5.31224885 13.3486705,5.65063949 L13.4220887,5.73904772 C13.42239,5.73938249 13.4227416,5.73966439 13.423043,5.73998154 L15.6691783,8.10568675 C15.8808229,8.32841038 16.2239648,8.32841038 16.4356094,8.10566913 L20.5769696,3.74750271 C20.5772709,3.74716795 20.5775723,3.7468508 20.5778904,3.74655128 C20.898279,3.4094089 20.898279,2.86273964 20.5778904,2.52559727 C20.2575019,2.18843727 19.7380425,2.18843727 19.4176707,2.52559727 Z" id="Combined-Shape"></path>
                                                    </g>
                                                </g>
                                            </g>
                                        </g>
                                    </g>
                                </g>
                            </svg>

                            <span class="kaktusf-cart-btn-text"></span>
                            <span class="kaktusf-cart-btn-added-text kaktusf-hide"></span>
                        </a>
                        <a href="#" class="kaktusf-product__actions--btn kaktusf-remove-btn ${popup_type === popupTypes.inline && 'kaktusf-remove-inline'} kaktusf-hide">
                            <svg class="kaktusf-product-cart product-cart" width="22px" height="20px" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="trash-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                <path fill="currentColor" d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path>
                            </svg>

                            <span class="kaktusf-remove-btn-text">Delete</span>
                        </a>
                    </div>
                </div>
                `;const element=document.createElement("div");element.classList.add("kaktusf-product__item","kaktusf-product__item--metro","kaktusf-product-item","kaktusf-product-border");element.innerHTML=html;if(addToCartAccepted){const addToCartBtns=element.querySelectorAll('.kaktusf-cart-btn');addToCartBtns.forEach(elem=>elem.classList.add('show-accepted'));}
addProductEvents(element,triggerType,popup_type);if(popup_type===popupTypes.inline){previewProductEvents(element,product);}
const rootDiv=getAppSelector('.kaktusf-product__wrapp');rootDiv.append(element);}
function addProductEvents(element,triggerType,popup_type){const qtyPlusBtn=element.querySelector('.kaktusf-product__quantity--plus');const qtyMinusBtn=element.querySelector('.kaktusf-product__quantity--minus');const qtyInput=element.querySelector('.kaktusf-qty-input');const addToCartBtn=element.querySelector('.kaktusf-cart-btn:not(.kaktusf-cart-btn-slider)');const variationSelect=element.querySelector('.kaktusf-variations');const removeBtn=element.querySelector('.kaktusf-remove-btn:not(.kaktusf-remove-btn-slider)');qtyPlusBtn.addEventListener("click",function(e){e.preventDefault();const qty=this.closest('.kaktusf-product__quantity').querySelector('.kaktusf-qty-input');changeQtyValue(qty,'add',maxQty);});qtyMinusBtn.addEventListener("click",function(e){e.preventDefault();const qty=this.closest('.kaktusf-product__quantity').querySelector('.kaktusf-qty-input');changeQtyValue(qty,'sub');});qtyInput.addEventListener("change",function(e){e.preventDefault();const qty=this;changeQtyValue(qty,'change',maxQty);});if(variationSelect){variationSelect.addEventListener("change",function(e){e.preventDefault();const variantPrice=this.selectedOptions[0].getAttribute('data-price');const variantStorePrice=this.selectedOptions[0].getAttribute('data-store-price');const element=this.closest('.kaktusf-product-item');if(element.querySelector('.kaktusf-cart-btn')){element.querySelector('.kaktusf-cart-btn').setAttribute('data-productId',this.value);element.querySelector('.kaktusf-cart-btn').setAttribute('data-storePrice',variantStorePrice);}else if(element.classList.contains('kaktusf-slider__item')){element.setAttribute('data-productId',this.value);element.setAttribute('data-storePrice',variantStorePrice);}
const activeImg=this.selectedOptions[0].getAttribute('data-image');if(popup_type===popupTypes.inline){const inCart=this.selectedOptions[0].getAttribute('data-added');if(inCart&&inCart==='true'){enableRemoveBtn(element);}else{enableCartBtn(element);}}
changeVariantPrice(element,variantPrice);changeVariantImage(element,activeImg)});}
if(addToCartBtn){addToCartBtn.addEventListener("click",function(e){e.preventDefault();const thisDataCart=this.getAttribute('data-cart');if(thisDataCart==='added')return;const product=this.closest('.kaktusf-product__item');const checkoutBtn=getAppSelector('.kaktusf-checkout-btn');checkoutBtn.classList.remove('kaktusf-disabled');const qtyInput=this.closest('.kaktusf-product__item').querySelector('.kaktusf-qty-input').value;const variantId=this.getAttribute('data-productId');const storePrice=this.getAttribute('data-storePrice');const discountType=this.closest('.kaktusf-product__item').querySelector('.kaktusf-save')?this.closest('.kaktusf-product__item').querySelector('.kaktusf-save').getAttribute('data-discountType'):null;const discountValue=this.closest('.kaktusf-product__item').querySelector('.kaktusf-save')?this.closest('.kaktusf-product__item').querySelector('.kaktusf-save').getAttribute('data-discount'):null;this.querySelector(".kaktusf-cart-btn-text").classList.add("kaktusf-hide");this.querySelector(".kaktusf-product-cart--active").style.display="none";if(popup_type!=popupTypes.inline){product.querySelector('.kaktusf-qty').classList.add('kaktusf-disabled');if(product.querySelector('.kaktusf-variations')){product.querySelector('.kaktusf-variations').classList.add('kaktusf-disabled');}}
this.classList.add('kaktusf-preload');setTimeout(()=>{this.classList.remove('kaktusf-preload');this.classList.add('kaktusf-hide');removeBtn.classList.remove('kaktusf-hide');removeBtn.querySelector(".kaktusf-remove-btn-text").classList.remove("kaktusf-hide");removeBtn.querySelector(".kaktusf-product-cart").style.display="flex";product.classList.add('kaktusf-product-added');if(popup_type===popupTypes.inline){setVariantAddedToCart(product,variantId,true);checkoutBtn.classList.remove('kaktusf-hide');}},1000);if(popup_type!=popupTypes.inline){showAddedProduct(product);}
statisticArr.push(offerId);if(thisDataCart==='add'){const propertyId=makeId(5);addItem(variantId,qtyInput,{offer:propertyId}).then(()=>{createOrderData(variantId,propertyId,discountType,discountValue,qtyInput);createPurchaseData(variantId,propertyId,storePrice);sendStatistic(offerId,true);checkAddedProduct();createAddedProductsData(variantId,propertyId);if(popup_type!=popupTypes.inline){this.setAttribute('data-cart','added');}
this.setAttribute('data-property',propertyId);if(!goToCheckoutAction){if(this.classList.contains('show-accepted')&&(!closePopupNumber||closePopupNumber>popupNumberCount)&&allowProducts){setTimeout(()=>{if(funnelsObj!=null&&funnelsObj.accepted!=null&&funnelsObj.accepted.products.length){showFunnel(funnelsObj.accepted,triggerType);popupNumberCount++;}else{if(allowPageReload){if(popup_type==popupTypes.inline){location.reload()}else{pageReload=true;}}}},1000);}else{if(allowPageReload){if(popup_type==popupTypes.inline){location.reload()}else{pageReload=true;}}}}else{createOrder();}});}else if(thisDataCart==='replace'){const propertyId=makeId(5);removeItemById(currentProductId).then(function(){addItem(variantId,qtyInput,{offer:propertyId}).then(function(){currentProductId=variantId;createOrderData(variantId,propertyId,discountType,discountValue,qtyInput);createPurchaseData(variantId,propertyId,storePrice);sendStatistic(offerId,true);setTimeout(()=>{if(replaceEvent===1){createOrder();}else{goToCart();}},1000);});})}});}
if(removeBtn){removeBtn.addEventListener("click",function(e){e.preventDefault();const product=this.closest('.kaktusf-product__item');const addProductBtn=product.querySelector('.kaktusf-cart-btn');const variantId=addProductBtn.getAttribute('data-productId');const propertyId=addProductBtn.getAttribute('data-property');this.querySelector(".kaktusf-remove-btn-text").classList.add("kaktusf-hide");this.querySelector(".kaktusf-product-cart").style.display="none";this.classList.add('kaktusf-preload');setTimeout(()=>{this.classList.remove('kaktusf-preload');this.classList.add('kaktusf-hide');addProductBtn.classList.remove('kaktusf-hide');addProductBtn.querySelector(".kaktusf-cart-btn-text").classList.remove("kaktusf-hide");addProductBtn.querySelector(".kaktusf-product-cart--active").style.display="flex";addProductBtn.setAttribute('data-cart','add');if(popup_type!=popupTypes.inline){product.querySelector('.kaktusf-qty').classList.remove("kaktusf-disabled");if(product.querySelector('.kaktusf-variations')){product.querySelector('.kaktusf-variations').classList.remove("kaktusf-disabled");}}else{setVariantAddedToCart(product,variantId,false);}
product.classList.remove('kaktusf-product-added');},1000);fetchCart().then(dataCart=>{let currentProductLine=0;dataCart.items.forEach((item,i)=>{if(parseInt(item.id)===parseInt(variantId)&&(item.properties&&(propertyId===item.properties.offer))){currentProductLine=i+1;}else if(this.classList.contains('kaktusf-remove-inline')&&parseInt(item.id)===parseInt(variantId)){currentProductLine=i+1;}});removeItemByLine(currentProductLine).then(()=>{addProductBtn.removeAttribute('data-property');if(allowPageReload&&popup_type==popupTypes.inline){location.reload()}}).catch(error=>console.error(error));});});}
function setVariantAddedToCart(product,variantId,param){if(product.querySelector('.kaktusf-variations')){const varianOptions=product.querySelectorAll('.kaktusf-variations option');varianOptions.forEach(option=>{const optionValue=parseInt(option.value);if(parseInt(variantId)===optionValue){option.setAttribute('data-added',param);}});}}
function enableRemoveBtn(product){const addToCartBtn=product.querySelector('.kaktusf-cart-btn');const removeBtn=product.querySelector('.kaktusf-remove-btn');addToCartBtn.classList.add('kaktusf-hide');addToCartBtn.querySelector(".kaktusf-product-cart--active").style.display="none";addToCartBtn.querySelector(".kaktusf-cart-btn-text").classList.add("kaktusf-hide");removeBtn.classList.remove('kaktusf-hide');removeBtn.querySelector(".kaktusf-remove-btn-text").classList.remove("kaktusf-hide");removeBtn.querySelector(".kaktusf-product-cart").style.display="flex";}
function enableCartBtn(product){const addToCartBtn=product.querySelector('.kaktusf-cart-btn');const removeBtn=product.querySelector('.kaktusf-remove-btn');addToCartBtn.classList.remove('kaktusf-hide');addToCartBtn.querySelector(".kaktusf-product-cart--active").style.display="flex";addToCartBtn.querySelector(".kaktusf-cart-btn-text").classList.remove("kaktusf-hide");removeBtn.classList.add('kaktusf-hide');removeBtn.querySelector(".kaktusf-remove-btn-text").classList.add("kaktusf-hide");removeBtn.querySelector(".kaktusf-product-cart").style.display="none";}}
function showRemoveButton(parentNode){const products=parentNode.querySelectorAll('.kaktusf-product__item');if(!products.length)return;let cartProducts=[];fetchCart().then(dataCart=>{if(dataCart.items.length){dataCart.items.forEach(item=>cartProducts.push(item.id));products.forEach(product=>{const addToCartBtn=product.querySelector('.kaktusf-cart-btn');const removeBtn=product.querySelector('.kaktusf-remove-btn');const productId=parseInt(addToCartBtn.getAttribute('data-productId'));if(cartProducts.includes(productId)){addToCartBtn.classList.add('kaktusf-hide');removeBtn.classList.remove('kaktusf-hide');product.querySelector('.kaktusf-qty').classList.add('kaktusf-disabled');}
if(product.querySelector('.kaktusf-variations')){const varianOptions=product.querySelectorAll('.kaktusf-variations option');varianOptions.forEach(option=>{const optionValue=parseInt(option.value);if(cartProducts.includes(optionValue)){option.setAttribute('data-added',true);}});}});}});}
function createAddedProductsData(variantId,propertyId){const targetProduct=getAppSelector('.kaktusf-alert-prod');if(!targetProduct)return;const targetId=targetProduct.getAttribute('data-target-id');if(!targetId)return;const localProductsData=localStorage.getItem('kaktusfProductsData');productsData=localProductsData?JSON.parse(localProductsData):productsData;let productData={targetProductId:targetId,funnelProducts:[]}
if(productsData.length){const checkTargetId=productsData.find(item=>item.targetProductId===targetId);if(checkTargetId){setProductsData(checkTargetId);}else{productsData.push(productData);setProductsData(productData);}}else{productsData.push(productData);setProductsData(productData);}
function setProductsData(data){data.funnelProducts.push({variantId:variantId,propertyId:propertyId})}
localStorage.setItem('kaktusfProductsData',JSON.stringify(productsData));}
function checkAddedProduct(){currentProductNumber++;if(!maxProductNumber)return;if(currentProductNumber>=maxProductNumber){const cartBtns=getAppSelectorAll('.kaktusf-cart-btn');cartBtns.forEach(item=>{item.classList.add('kaktusf-disabled');item.setAttribute('data-cart','off');});}}
function calcVariantsDiscountPrice(product,variants){const variantPrice=getPriceByRate(parseFloat(variants['variantPrice']));const discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;if(product.discount_type==="%"){return(variantPrice-(variantPrice*+discountVal / 100)).toFixed(2);}else{return(+variantPrice- +discountVal).toFixed(2);}}
function fillBundleProduct(product,popup_type){const productTitle=product.title;const productDescription=product.description;const productImg=product.variants[0].image||noImage;let discount='';let productPrice=getPriceByRate(product.variants[0].variantPrice);let comparePrice='';let minQty=product.bundle_qty?product.bundle_qty:1;let bundleQty="";let variantsBlockHtml='';let variantIds=[];let variantStorePrice=[];if(product.variants.length>1){let variantsHtml=`<select class="kaktusf-variations" data-productId="${product.variants[0].productId}" data-storePrice="${product.variants[0].variantPrice}">`;for(let key in product.variants){let variantPrice=getPriceByRate(product.variants[key]['variantPrice']);if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){variantPrice=calcVariantsDiscountPrice(product,product.variants[key]);}
variantsHtml+=`
                        <option
                            value="${product.variants[key]['productId']}"
                            data-price="${getPriceByRate(product.variants[key]['variantPrice'])}"
                            data-store-price="${product.variants[key]['variantPrice']}"
                            data-compare-price="${getPriceByRate(product.variants[key]['variantComparePrice'])}"
                            data-diccounted-price="${variantPrice}"
                            data-image="${product.variants[key].image}"
                        >
                            ${product.variants[key]['title']} - ${currencyFormat(variantPrice)}
                        </option>
                    `;}
variantsHtml+='</select>';if(+minQty>1){let totalVariantPrice=0;for(let i=0;i<+minQty;i++){variantsBlockHtml+=`<div class="kaktusf-variant-row"><span>#${i + 1}</span> ${variantsHtml}</div>`;variantIds.push(product.variants[0].productId);totalVariantPrice+=+product.variants[0].variantPrice}
productPrice=getPriceByRate(totalVariantPrice);}else{variantsBlockHtml=variantsHtml;variantIds.push(product.variants[0].productId);}}else{variantIds.push(product.variants[0].productId);if(+minQty>1){bundleQty=`<span class="kaktusf-save-label kaktusf-qty-label">x${minQty}</span>`}}
if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){let discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;discount=`
                    <div class="kaktusf-price--compare">
                        <span class="kaktusf-save-label">
                            <span class="kaktusf-save" data-discount="${discountVal}" data-discountType="${product.discount_type}"></span>

                            ${(product.discount_type === "%")
                                ? `<span class="kaktusf-price--compare-save">&nbsp;${Math.round(discountVal)}</span>${product.discount_type}`
                                : `<span class="kaktusf-price--compare-save">&nbsp;${currencyFormat(discountVal)}</span>`
                            }
                        </span>
                    </div>
                `;let compareTotalPrice=calcTotalProductPrice(product,productPrice,minQty);comparePrice=`<span class="kaktusf-price--compare-price kaktusf-compare-price" data-compare-price="${compareTotalPrice}">${currencyFormat(productPrice)}</span>`;if(product.discount_type==="%"){productPrice=(+productPrice-(+productPrice*+product.discount / 100));}else{productPrice=(+productPrice- +discountVal);}}
let totalProductPrice=calcTotalProductPrice(product,productPrice,minQty);productPrice=currencyFormat(productPrice);const html=`
                <div class="kaktusf-bundle-icon"><div></div></div>

                <div class="kaktusf-bundle-product-wrap width90 kaktusf-product-border">
                    <div class="kaktusf-product__content" data-productId="${variantIds.join(',')}" data-storePrice="${product.variants[0].variantPrice}">
                        <div class="kaktusf-product__img">
                            <img class="kaktusf-product--img kaktusf-product--img-width" src="${productImg}" alt="Product">
                        </div>
                        ${discount}

                        <div class="kaktusf-prod-det">
                            <h2 class="kaktusf-product__title kaktusf-prod-title">${productTitle}</h2>
                            <p class="kaktusf-prod-desc">
                                <span class="kaktusf-desc-short">${productDescription}</span>
                                <span class="kaktusf-desc-full kaktusf-hide">${productDescription}</span>
                            </p>
                            <div class="kaktusf-product__info--variations kaktusf-variations-wrap">
                                ${variantsBlockHtml}
                            </div>
                        </div>
                    </div>

                    <div class="kaktusf-product__info kaktusf-product-bg">
                        <div class="kaktusf-product__info--top">
                            <div class="kaktusf-product__price">
                                <span class="kaktusf-price--main kaktusf-price" data-product-price="${totalProductPrice}">${productPrice}</span>
                                ${comparePrice}
                            </div>

                            ${bundleQty}
                            <input class="kaktusf-qty-input" type="hidden" value="${minQty}">
                        </div>
                    </div>
                </div>

                <div class="kaktusf-active-product kaktusf-active-product--bundles">
                    <label>
                        <input type="checkbox" checked class="kaktusf-check-product ${product.fbtTriggeredProduct ? 'kaktusf-triggered-product' : ''}"${product.fbtTriggeredProduct ? 'disabled="true"' : ''}>
                        <div class="kaktusf-check"></div>
                    </label>
                </div>
                `;const element=document.createElement("div");element.setAttribute('data-active',true);element.classList.add("kaktusf-product__item","kaktusf-product__item--metro","kaktusf-product-item","kaktusf-product-border","kaktusf-product__wrapper","kaktusf-bundle-product");element.innerHTML=html;const variationSelect=element.querySelectorAll('.kaktusf-variations');if(variationSelect.length){variationSelect.forEach(select=>{select.addEventListener("change",function(e){e.preventDefault();let variantPrice=this.selectedOptions[0].getAttribute('data-price');let variantDiscountPrice=this.selectedOptions[0].getAttribute('data-diccounted-price');const variantStorePrice=this.selectedOptions[0].getAttribute('data-store-price');const activeImg=this.selectedOptions[0].getAttribute('data-image');const element=this.closest('.kaktusf-product-item');const variants=element.querySelectorAll('.kaktusf-variations');let productId=this.value;if(variants.length>1){let variantIds=[];let resultPrice=0;let resultDiscountPrice=0;variants.forEach(item=>{const itemId=item.selectedOptions[0].value;const itemPrice=+item.selectedOptions[0].getAttribute('data-price');const itemDiscountPrice=+item.selectedOptions[0].getAttribute('data-diccounted-price');variantIds.push(itemId);resultPrice+=itemPrice;resultDiscountPrice+=itemDiscountPrice;})
productId=variantIds.join(',');variantPrice=resultPrice;variantDiscountPrice=resultDiscountPrice;}
element.querySelector('.kaktusf-product__content').setAttribute('data-productId',productId);element.querySelector('.kaktusf-product__content').setAttribute('data-storePrice',variantStorePrice);element.querySelector('.kaktusf-price').setAttribute('data-product-price',variantDiscountPrice);let comparePrice=element.querySelector('.kaktusf-compare-price');if(comparePrice){comparePrice.setAttribute('data-compare-price',variantPrice);}
changeVariantImage(element,activeImg);changeVariantPrice(element,variantPrice);changeBundleTotalPrice();changeBundleComparePrice();});})}
previewProductEvents(element,product);const rootDiv=getAppSelector('.kaktusf-product__wrapp');rootDiv.append(element);}
function fillFbtProduct(product,popup_type){const productTitle=product.title;const productDescription=product.description;let discount='';let productPrice=getPriceByRate(product.variants[0].variantPrice);let comparePrice='';let minQty=product.bundle_qty?product.bundle_qty:1;let bundleQty="";let variantsBlockHtml='';let variantIds=[];let variantStorePrice=[];if(product.variants.length>1){let variantsHtml=`<select class="kaktusf-variations" data-productId="${product.variants[0].productId}" data-storePrice="${product.variants[0].variantPrice}">`;for(let key in product.variants){let variantPrice=getPriceByRate(product.variants[key]['variantPrice']);if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){variantPrice=calcVariantsDiscountPrice(product,product.variants[key]);}
variantsHtml+=`
                        <option
                            value="${product.variants[key]['productId']}"
                            data-price="${getPriceByRate(product.variants[key]['variantPrice'])}"
                            data-store-price="${product.variants[key]['variantPrice']}"
                            data-compare-price="${getPriceByRate(product.variants[key]['variantComparePrice'])}"
                            data-diccounted-price="${variantPrice}"
                            data-image="${product.variants[key].image}">
                            ${product.variants[key]['title']} - ${currencyFormat(variantPrice)}
                        </option>
                    `;}
variantsHtml+='</select>';if(+minQty>1){let totalVariantPrice=0;for(let i=0;i<+minQty;i++){variantsBlockHtml+=`<div class="kaktusf-variant-row"><span>#${i + 1}</span> ${variantsHtml}</div>`;variantIds.push(product.variants[0].productId);totalVariantPrice+=+product.variants[0].variantPrice}
productPrice=getPriceByRate(totalVariantPrice);}else{variantsBlockHtml=variantsHtml;variantIds.push(product.variants[0].productId);}}else{variantIds.push(product.variants[0].productId);if(+minQty>1){bundleQty=`<span class="kaktusf-save-label kaktusf-qty-label">x${minQty}</span>`}}
if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){let discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;discount=`
                    <div class="kaktusf-price--compare kaktusf-price--discount">
                        <span class="kaktusf-save-label">
                            <span class="kaktusf-save" data-discount="${discountVal}" data-discountType="${product.discount_type}"></span>

                            ${(product.discount_type === "%")
                                ? `<span class="kaktusf-price--compare-save">&nbsp;${Math.round(discountVal)}</span>${product.discount_type}`
                                : `<span class="kaktusf-price--compare-save">&nbsp;${discountVal}</span>&nbsp;${currencyFormat()}`
                            }
                        </span>
                    </div>
                `;let compareTotalPrice=calcTotalProductPrice(product,productPrice,minQty);comparePrice=`<span class="kaktusf-price--compare-price kaktusf-compare-price" data-compare-price="${compareTotalPrice}">${currencyFormat(productPrice)}</span>`;if(product.discount_type==="%"){productPrice=(+productPrice-(+productPrice*+product.discount / 100));}else{productPrice=(+productPrice- +discountVal);}}
let totalProductPrice=calcTotalProductPrice(product,productPrice,minQty);productPrice=currencyFormat(productPrice);const html=`
            <div class="kaktusf-bundle-product-wrap kaktusf-product-border" style="margin-left: 5px;">
                ${discount}
               <div class="kaktusf-product__content" style="display: contents;"  data-productId="${variantIds.join(',')}" data-storePrice="${product.variants[0].variantPrice}">
                 <div class="kaktusf-prod-det">
                            <h2 class="kaktusf-product__title kaktusf-prod-title">${productTitle}</h2>
                            <p class="kaktusf-prod-desc">
                                <span class="kaktusf-desc-short">${productDescription}</span>
                                <span class="kaktusf-desc-full kaktusf-hide">${productDescription}</span>
                            </p>
                              </div>
                            <div class="kaktusf-product__info--variations kaktusf-variations-wrap">
                                ${variantsBlockHtml}
                            </div>
                        </div>

                    </div>

                    <div class="kaktusf-product__item kaktusf-product__info--fbt">
                        <div class="kaktusf-product__info--top">
                            <div class="kaktusf-product__price">
                                <span class="kaktusf-price--main kaktusf-price" data-product-price="${totalProductPrice}">${productPrice}</span>
                                ${comparePrice}
                            </div>
                        </div>
                            ${bundleQty}
                            <input class="kaktusf-qty-input" type="hidden" value="${minQty}">
                        </div>
                        <div class="kaktusf-active-product">
                    <label>
                        <input type="checkbox" checked class="kaktusf-check-product ${product.fbtTriggeredProduct ? 'kaktusf-triggered-product' : ''}"${product.fbtTriggeredProduct ? 'disabled="true"' : ''}>
                        <div class="kaktusf-check"></div>
                    </label>
                      </div>
                </div>
                </div>
                `;const element=document.createElement("div");element.setAttribute('data-active',true);element.classList.add("kaktusf-product__wrapper","kaktusf-bundle-product","kaktusf-product-item","kaktusf-product--item","kaktusf-product--margin");element.innerHTML=html;const variationSelect=element.querySelectorAll('.kaktusf-variations');if(variationSelect.length){variationSelect.forEach(select=>{select.addEventListener("change",function(e){e.preventDefault();let variantPrice=this.selectedOptions[0].getAttribute('data-price');let variantDiscountPrice=this.selectedOptions[0].getAttribute('data-diccounted-price');const variantStorePrice=this.selectedOptions[0].getAttribute('data-store-price');const activeImg=this.selectedOptions[0].getAttribute('data-image');const element=this.closest('.kaktusf-product-item');const variants=element.querySelectorAll('.kaktusf-variations');let productId=this.value;if(variants.length>1){let variantIds=[];let resultPrice=0;let resultDiscountPrice=0;variants.forEach(item=>{const itemId=item.selectedOptions[0].value;const itemPrice=+item.selectedOptions[0].getAttribute('data-price');const itemDiscountPrice=+item.selectedOptions[0].getAttribute('data-diccounted-price');variantIds.push(itemId);resultPrice+=itemPrice;resultDiscountPrice+=itemDiscountPrice;})
productId=variantIds.join(',');variantPrice=resultPrice;variantDiscountPrice=resultDiscountPrice;}
element.querySelector('.kaktusf-product__content').setAttribute('data-productId',productId);element.querySelector('.kaktusf-product__content').setAttribute('data-storePrice',variantStorePrice);element.querySelector('.kaktusf-price').setAttribute('data-product-price',variantDiscountPrice);let comparePrice=element.querySelector('.kaktusf-compare-price');if(comparePrice){comparePrice.setAttribute('data-compare-price',variantPrice);}
changeVariantImage(element,activeImg);changeVariantPrice(element,variantPrice);changeBundleTotalPrice();changeBundleComparePrice();});})}
previewProductEventsFBT(element,product);const rootDiv=getAppSelector('.kaktusf-product__wrapp--fbt');rootDiv.append(element);}
function fillBundleProductImg(product,popup_type){const productImg=product.variants[0].image||noImage;let discount='';if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){let discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;discount=`
                    <div class="kaktusf-price--compare">
                        <span class="kaktusf-save-label" style="display: flex;">
                            <span class="kaktusf-save" data-discount="${discountVal}" data-discountType="${product.discount_type}"></span>

                            ${(product.discount_type === "%")
                                ? `<span class="kaktusf-price--compare-save">&nbsp;${Math.round(discountVal)}</span>${product.discount_type}`
                                : `<span class="kaktusf-price--compare-save">&nbsp;${currencyFormat(discountVal)}</span>`
                            }
                        </span>
                    </div>
                `;}
const htmlimg=`
                         <span class="m-auto">+</span>
                        <div class="kaktusf-product__img kaktusf__img--position  product__size flex-c">
                            <img class="kaktusf-product--img" src="${productImg}" alt="Product">
                            <div class="discount__wrapper">
                            ${discount}
                            </div>
                        </div>`;const element=document.createElement("div");element.setAttribute('data-active',true);element.classList.add("kaktusf-product__image");element.innerHTML=htmlimg;const rootDiv=getAppSelector('.kaktusf-product__wrapp--img');rootDiv.append(element);}
function calcTotalProductPrice(product,price,qty=1){if(product.variants.length>1){return price}
return(+qty>1)?price*+qty:price;}
function changeBundleTotalPrice(){const product=getAppSelectorAll('.kaktusf-product__wrapper');const totalPrice=getAppSelector('.kaktusf-total-price');let total=0;product.forEach(item=>{const isActive=item.getAttribute('data-active');if(isActive==='true'){const price=item.querySelector('.kaktusf-price--main').getAttribute('data-product-price');total+=+price;}});totalPrice.innerText=currencyFormat(total);}
function changeBundleComparePrice(){let bundleSaleLabel=document.querySelector('.kaktusf-total-save');if(!bundleSaleLabel)return;const product=getAppSelectorAll('.kaktusf-product__wrapper');const totalComparePrice=getAppSelector('.kaktusf-compare-total');let total=0;product.forEach(item=>{const isActive=item.getAttribute('data-active');if(isActive==='true'){const price=item.querySelector('.kaktusf-compare-price')?item.querySelector('.kaktusf-compare-price').getAttribute('data-compare-price'):item.querySelector('.kaktusf-price').getAttribute('data-product-price');total+=+price;}});totalComparePrice.innerText=currencyFormat(total);}
function buildBundleASaleLabel(dataOffer,offer_data,rootDiv){const discount=dataOffer.discount[offer_data.id][0].discount;const discount_type=dataOffer.discount[offer_data.id][0].discount_type;const offer_discount=typeof discount!=undefined?discount:null;const offer_discount_type=typeof discount_type!=undefined?discount_type:null;if(!offer_discount||!offer_discount_type||parseInt(offer_discount)===0)return;let discountVal=Math.round(offer_discount);const html=`
                <span class="kaktusf-save"></span>
                <span>${discountVal}</span>${(offer_discount_type === "%") ? offer_discount_type : `${offer_discount_type}`}
            `;const element=document.createElement("span");element.classList.add("kaktusf-save-label","kaktusf-total-save");element.innerHTML=html;rootDiv.querySelector('.kaktusf-popup__total--price').append(element);}
function showActiveCheckbox(){const products=getAppSelectorAll('.kaktusf-product__wrapper');products.forEach(product=>{const item=product.querySelector('.kaktusf-active-product');item.classList.remove('kaktusf-hide');});}
function changeVariantPrice(element,price){const priceContainer=element.querySelector(".kaktusf-compare-price");const mainPriceContainer=element.querySelector(".kaktusf-price");const discountContainer=element.querySelector(".kaktusf-save");let newPrice=price;if(discountContainer){const discountValue=discountContainer.getAttribute("data-discount");const discountType=discountContainer.getAttribute("data-discountType");if(discountType==="%"){newPrice=(+price-(+price*+discountValue / 100)).toFixed(2);}else{newPrice=(+price- +discountValue).toFixed(2);}}
if(priceContainer){priceContainer.innerText=currencyFormat(price);}
mainPriceContainer.innerText=currencyFormat(newPrice)}
function changeVariantImage(element,activeImage){const imgWrap=document.querySelector('.kaktusf-product__wrapp--img');if(!activeImage)return;if(imgWrap){const index=[...element.parentElement.children].indexOf(element);imgWrap.children[index].querySelector('img').setAttribute('src',activeImage);}else{const image=element.querySelector('.kaktusf-product__img img');image.setAttribute('src',activeImage);}}
function changeQtyValue(qty,type,maxVal){let currentQty=+qty.value;let minValue=+qty.getAttribute('min');let nextQty;switch(type){case'add':{if(maxVal){maxVal=+maxVal;nextQty=currentQty<maxVal?currentQty+1:maxVal;}else{nextQty=currentQty+1;}
break;}
case'sub':{currentQty===minValue?nextQty=minValue:nextQty=currentQty-1;break;}
case'change':{if(maxVal){maxVal=+maxVal;nextQty=currentQty<maxVal?currentQty:maxVal;}else{nextQty=currentQty;}
if(nextQty<=0){nextQty=1;}}}
qty.value=nextQty;}
function getDOMSelector(defaultNodeElements,settingsNodeElements){const commonNodeArr=settingsNodeElements.concat(defaultNodeElements);const uniqueNodeArr=[...new Set(commonNodeArr)];if(uniqueNodeArr.length){for(let i=0;i<uniqueNodeArr.length;i++){const itemTrim=uniqueNodeArr[i].trim();const currentNode=document.querySelector(itemTrim);if(currentNode!=null){return currentNode;}}}else{return null;}}
function getDOMSelectorClass(defaultNodeElements,settingsNodeElements){const commonNodeArr=settingsNodeElements.concat(defaultNodeElements);const uniqueNodeArr=[...new Set(commonNodeArr)];if(uniqueNodeArr.length){for(let i=0;i<uniqueNodeArr.length;i++){const itemTrim=uniqueNodeArr[i].trim();const currentNode=document.querySelector(itemTrim);if(currentNode!=null){return itemTrim;}}}else{return null;}}
function makeId(length){let result='';const characters='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';const charactersLength=characters.length;for(let i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength));}
return result;}
function changeWidgetText(element,offerTexts){const titleRow=element.querySelector('.kaktusf-title');const descriptionRow=element.querySelector('.kaktusf-description');const timerRow=element.querySelector('.kaktusf-timer-msg');titleRow.innerText=offerTexts.title;if(offerTexts.allow_set_description){descriptionRow.classList.remove('kaktusf-hide');descriptionRow.innerText=offerTexts.description;}else{descriptionRow.classList.add('kaktusf-hide');}
timerRow.innerText=offerTexts.timer_text;}
function showAddedProduct(product){const topSection=getAppSelector('.kaktusf-popup__top');const cartImg=getAppSelector('.kaktusf-popup__cart-alert--img');const productSpan=getAppSelector('.kaktusf-alert-prod span');productSpan.innerText="";cartImg.innerHTML="";const img=product.querySelector(".kaktusf-product__img img").cloneNode(true);const title=product.querySelector(".kaktusf-prod-title").innerText;productSpan.innerText=title;cartImg.append(img);if(window.innerWidth<768){slideDown(topSection,1000);setTimeout(function(){slideUp(topSection,1000)},3000);}else{topSection.style.display="flex";}}
window.addEventListener('resize',function(){const topSection=iframe?iframe.contentWindow.document.querySelector('.kaktusf-popup__top'):false;if(topSection){if(window.innerWidth<768){topSection.style.display="none";}else{topSection.style.display="flex";}}});function fillTargetProduct(targetProduct){const cartText=getAppSelector('.kaktusf-popup__cart-alert');const cartImg=getAppSelector('.kaktusf-popup__cart-alert--img');const productSpan=getAppSelector('.kaktusf-alert-prod span');cartText.classList.remove('kaktusf-hide');cartImg.innerHTML='';productSpan.innerText='';const productTitle=targetProduct.product_title;let productImg=noImage;if(targetProduct.image!=undefined){productImg=targetProduct.image;}
const imgHtml=document.createElement('img');imgHtml.src=productImg;imgHtml.alt="product";productSpan.innerText=productTitle;cartImg.append(imgHtml);}
function actionEvents(targetDiv,triggerType){const closeBtn=targetDiv.querySelector('.kaktusf-close');const rejectBtns=targetDiv.querySelector('.kaktusf-reject-btn');const checkoutBtns=targetDiv.querySelector('.kaktusf-checkout-btn');if(closeBtn){closeBtn.addEventListener("click",function(e){e.preventDefault();const closeEvent=this.getAttribute('data-close');if(this.classList.contains('show-decline')&&(!closePopupNumber||closePopupNumber>popupNumberCount)){if(funnelsObj!=null&&funnelsObj.decline!=null&&funnelsObj.decline.products.length){sendStatistic(offerId);showFunnel(funnelsObj.decline,triggerType);popupNumberCount++;}else{closeModal(closeEvent);}}else{closeModal(closeEvent);}});}
rejectBtns.addEventListener("click",function(e){e.preventDefault();const closeEvent=this.getAttribute('data-close');const redirectUrl=this.getAttribute('data-redirect');if(this.classList.contains('show-decline')&&(!closePopupNumber||closePopupNumber>popupNumberCount)){if(funnelsObj!=null&&funnelsObj.decline!=null&&funnelsObj.decline.products.length){sendStatistic(offerId);showFunnel(funnelsObj.decline,triggerType);popupNumberCount++;}else{rejectBtnEvents(closeEvent,redirectUrl);}}else{rejectBtnEvents(closeEvent,redirectUrl);}})
checkoutBtns.addEventListener("click",function(e){e.preventDefault();const checkoutEvent=this.getAttribute('data-checkout');const redirectUrl=this.getAttribute('data-redirect');if(this.classList.contains('show-accepted')&&(!closePopupNumber||closePopupNumber>popupNumberCount)){if(funnelsObj!=null&&funnelsObj.accepted!=null&&funnelsObj.accepted.products.length){sendStatistic(offerId);showFunnel(funnelsObj.accepted,triggerType);popupNumberCount++;}else{sendStatistic(offerId);setTimeout(()=>{checkoutBtnEvents(checkoutEvent,redirectUrl);},1000)}}else{sendStatistic(offerId);setTimeout(()=>{checkoutBtnEvents(checkoutEvent,redirectUrl);},1000)}});}
function actionBundle(targetDiv,bundle_min_qty){const closeBtn=targetDiv.querySelector('.kaktusf-close');const checkoutBtn=targetDiv.querySelector('.kaktusf-checkout-btn');const product=targetDiv.querySelectorAll('.kaktusf-product__item');const allowCheckbox=targetDiv.querySelectorAll('.kaktusf-check-product');if(closeBtn){closeBtn.addEventListener("click",function(e){e.preventDefault();const closeEvent=this.getAttribute('data-close');if(closeEvent==="2"){sendStatistic(offerId);setTimeout(()=>{createOrder();},1000);}else{sendStatistic(offerId);if(countDown){clearInterval(countDown);}
removeAppContainer();statisticArr.length=0;if(allowPageReload&&pageReload){setTimeout(()=>{cartReload();},1000);}}});}
checkoutBtn.addEventListener("click",function(e){e.preventDefault();const checkoutEvent=this.getAttribute('data-checkout');const redirectUrl=this.getAttribute('data-redirect');const bundleId=makeId(5);statisticArr.push(offerId);let productCount=0;let isTriggerProductInFunnel=false;const productBundleData=getBundleProducts(product);let activeProductsLength=+productBundleData.length;const triggerProductInFunnel=productBundleData.find(item=>parseInt(item.variantId)===parseInt(currentProductId));if(triggerProductInFunnel){isTriggerProductInFunnel=true;}
fetchCart().then(function(dataCart){targetDiv.querySelector('.kaktusf-popup__body').classList.add('kaktusf-preload');let currentProductLine=0;dataCart.items.forEach((item,i)=>{if(parseInt(item.id)===parseInt(currentProductId)&&(!!!item.properties||(item.properties&&!item.properties.offer))){currentProductLine=i+1;}});if(isTriggerProductInFunnel){removeItemByLine(currentProductLine).then(()=>{addBundleProducts(productBundleData);});}else{addBundleProducts(productBundleData);}});function addBundleProducts(productBundleData){if(!productBundleData.length)return
productBundleData.forEach((productItem,i)=>{setTimeout(()=>{const{propertyId,variantId,storePrice,discountType,discountValue,qty}=productItem;addItem(variantId,qty,{offer:propertyId}).then(()=>{createOrderData(variantId,propertyId,discountType,discountValue,qty);createPurchaseData(variantId,propertyId,storePrice);createBundleProductsData(bundleId,variantId,propertyId);productCount++
if(allowPageReload){pageReload=true;}
if(activeProductsLength===productCount){sendStatistic(offerId,true);setTimeout(()=>{checkoutBtnEvents(checkoutEvent,redirectUrl);},1500);}})},1000*i);});}});allowCheckbox.forEach(item=>{item.addEventListener("click",function(){const el=this.closest('.kaktusf-product-item');toggleActiveProducts(targetDiv,bundle_min_qty);if(this.checked){el.setAttribute('data-active',true);el.querySelector('.kaktusf-bundle-product-wrap').classList.remove('kaktusf-inactive');}else{el.setAttribute('data-active',false);el.querySelector('.kaktusf-bundle-product-wrap').classList.add('kaktusf-inactive');}
changeBundleTotalPrice();changeBundleComparePrice();});})};function getBundleProducts(product){let productBundleData=[];product.forEach(item=>{const isActive=item.getAttribute('data-active');if(isActive==='true'){const variants=item.querySelectorAll('.kaktusf-variations');if(variants.length){let uniqIds=[];variants.forEach(variantItem=>{const variantId=variantItem.selectedOptions[0].value;if(uniqIds.includes(variantId)){const targetElement=productBundleData.find(el=>+el.variantId===+variantId);targetElement.qty=+targetElement.qty+1;}else{productBundleData.push({propertyId:makeId(5),variantId,storePrice:variantItem.selectedOptions[0].getAttribute('data-store-price'),discountType:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discountType'):null,discountValue:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discount'):null,qty:1})
uniqIds.push(variantId);}})}else{productBundleData.push({propertyId:makeId(5),variantId:item.querySelector('.kaktusf-product__content').getAttribute('data-productId'),storePrice:item.querySelector('.kaktusf-product__content').getAttribute('data-storePrice'),discountType:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discountType'):null,discountValue:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discount'):null,qty:+item.querySelector('.kaktusf-qty-input').value})}}});return productBundleData}
function actionFbt(targetDiv,bundle_min_qty){const closeBtn=targetDiv.querySelector('.kaktusf-close');const checkoutBtn=targetDiv.querySelector('.kaktusf-checkout-btn');const product=targetDiv.querySelectorAll('.kaktusf-product--item');const allowCheckbox=targetDiv.querySelectorAll('.kaktusf-check-product');if(closeBtn){closeBtn.addEventListener("click",function(e){e.preventDefault();const closeEvent=this.getAttribute('data-close');if(closeEvent==="2"){sendStatistic(offerId);setTimeout(()=>{createOrder();},1000);}else{sendStatistic(offerId);if(countDown){clearInterval(countDown);}
removeAppContainer();statisticArr.length=0;if(allowPageReload&&pageReload){setTimeout(()=>{cartReload();},1000);}}});}
checkoutBtn.addEventListener("click",function(e){e.preventDefault();const checkoutEvent=this.getAttribute('data-checkout');const redirectUrl=this.getAttribute('data-redirect');const bundleId=makeId(5);statisticArr.push(offerId);let productCount=0;let isTriggerProductInFunnel=false;const productBundleData=getBundleProducts(product);let activeProductsLength=+productBundleData.length;const triggerProductInFunnel=productBundleData.find(item=>parseInt(item.variantId)===parseInt(currentProductId));if(triggerProductInFunnel){isTriggerProductInFunnel=true;}
fetchCart().then(function(dataCart){targetDiv.querySelector('.kaktusf-popup__body').classList.add('kaktusf-preload');let currentProductLine=0;dataCart.items.forEach((item,i)=>{if(parseInt(item.id)===parseInt(currentProductId)&&(!!!item.properties||(item.properties&&!item.properties.offer))){currentProductLine=i+1;}});if(isTriggerProductInFunnel){removeItemByLine(currentProductLine).then(()=>{addBundleProducts(productBundleData);});}else{addBundleProducts(productBundleData);}});function addBundleProducts(productBundleData){if(!productBundleData.length)return
productBundleData.forEach((productItem,i)=>{setTimeout(()=>{const{propertyId,variantId,storePrice,discountType,discountValue,qty}=productItem;addItem(variantId,qty,{offer:propertyId}).then(()=>{createOrderData(variantId,propertyId,discountType,discountValue,qty);createPurchaseData(variantId,propertyId,storePrice);createBundleProductsData(bundleId,variantId,propertyId);productCount++
if(activeProductsLength===productCount){sendStatistic(offerId,true);setTimeout(()=>{if(allowPageReload){location.reload();}
checkoutBtnEvents(checkoutEvent,redirectUrl);},1500);}})},1000*i);});}});allowCheckbox.forEach(item=>{item.addEventListener("click",function(){const el=this.closest('.kaktusf-product--item');const imgWrap=document.querySelector('.kaktusf-product__wrapp--img');toggleActiveProducts(targetDiv,bundle_min_qty);if(this.checked){el.setAttribute('data-active',true);el.querySelector('.kaktusf-bundle-product-wrap').classList.remove('kaktusf-inactive');if(imgWrap){const index=[...el.parentElement.children].indexOf(el);imgWrap.children[index].classList.remove('hide');}}else{el.setAttribute('data-active',false);el.querySelector('.kaktusf-bundle-product-wrap').classList.add('kaktusf-inactive');if(imgWrap){const index=[...el.parentElement.children].indexOf(el);imgWrap.children[index].classList.add('hide');}}
changeBundleTotalPrice();changeBundleComparePrice();});})};function getBundleProducts(product){let productBundleData=[];product.forEach(item=>{const isActive=item.getAttribute('data-active');if(isActive==='true'){const variants=item.querySelectorAll('.kaktusf-variations');if(variants.length){let uniqIds=[];variants.forEach(variantItem=>{const variantId=variantItem.selectedOptions[0].value;if(uniqIds.includes(variantId)){const targetElement=productBundleData.find(el=>+el.variantId===+variantId);targetElement.qty=+targetElement.qty+1;}else{productBundleData.push({propertyId:makeId(5),variantId,storePrice:variantItem.selectedOptions[0].getAttribute('data-store-price'),discountType:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discountType'):null,discountValue:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discount'):null,qty:1})
uniqIds.push(variantId);}})}else{productBundleData.push({propertyId:makeId(5),variantId:item.querySelector('.kaktusf-product__content').getAttribute('data-productId'),storePrice:item.querySelector('.kaktusf-product__content').getAttribute('data-storePrice'),discountType:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discountType'):null,discountValue:item.querySelector('.kaktusf-save')?item.querySelector('.kaktusf-save').getAttribute('data-discount'):null,qty:+item.querySelector('.kaktusf-qty-input').value})}}});return productBundleData}
function createBundleProductsData(bundleId,variantId,propertyId){if(!bundleId)return;const localBundleData=localStorage.getItem('kaktusfBundleData');let bundleData=localBundleData?JSON.parse(localBundleData):[];let productData={bundleId:bundleId,bundleProducts:[]}
if(bundleData.length){const checkBundleId=bundleData.find(item=>item.bundleId===bundleId);if(checkBundleId){setProductsData(checkBundleId);}else{bundleData.push(productData);setProductsData(productData);}}else{bundleData.push(productData);setProductsData(productData);}
localStorage.setItem('kaktusfBundleData',JSON.stringify(bundleData));function setProductsData(data){data.bundleProducts.push({variantId:variantId,propertyId:propertyId})}}
function toggleActiveProducts(targetDiv,bundle_min_qty){const allowCheckbox=targetDiv.querySelectorAll('.kaktusf-check-product');let activeProductsLength=0;allowCheckbox.forEach(item=>{if(item.checked){activeProductsLength++;}});if(parseInt(bundle_min_qty)>0&&parseInt(activeProductsLength)<=parseInt(bundle_min_qty)){allowCheckbox.forEach(item=>{if(!item.classList.contains('kaktusf-triggered-product')&&item.checked){item.setAttribute('disabled',true);}});}else{allowCheckbox.forEach(item=>{if(!item.classList.contains('kaktusf-triggered-product')){item.removeAttribute('disabled')}});}}
function checkoutBtnEvents(val,customUrl){const goCheckout='1';const goCart='2';const goCustomUrl='3';const closePopUp='4';switch(val){case goCheckout:createOrder();break;case goCart:goToCart();break;case goCustomUrl:if(customUrl)location.href=`https://${customUrl}`;break;case closePopUp:closeModal();break;default:createOrder();break;}}
function rejectBtnEvents(val,customUrl){const goCheckout='2';const goCart='3';const goCustomUrl='4';switch(val){case goCheckout:createOrder();break;case goCart:goToCart();break;case goCustomUrl:if(customUrl)location.href=`https://${customUrl}`;break;default:closeModal(val);break;}}
function closeModal(closeEvent='1'){const goCheckout='2';if(closeEvent===goCheckout){sendStatistic(offerId);setTimeout(()=>{createOrder();},1000);}else{sendStatistic(offerId);if(countDown){clearInterval(countDown);}
if(sliderAutoplay){clearInterval(sliderAutoplay);}
removeAppContainer();statisticArr.length=0;if(pageReload){setTimeout(()=>{cartReload();},1000);}}}
function buildWidget(dataOffer){fillWidget(dataOffer);fillWidgetSettings(dataOffer);}
const dataJsonTopSection={"kaktusf-background-top":{data:"top",value:"background_top",input:"kaktusf-bg-top-input",element:"kaktusf-bg-top",cssOption:"background"},"kaktusf-close-btn-bd-radius":{data:"top",value:"close_border_radius",input:"kaktusf-close-border-radius",element:"kaktusf-close",cssOption:"border-radius",cssType:"size"},"kaktusf-alert-text-color":{data:"top",value:"alert_text_color",input:"kaktusf-alert-text-color",element:"kaktusf-alert-text",cssOption:"color"},"kaktusf-alert-text-font-size":{data:"top",value:"alert_text_font_size",input:"kaktusf-alert-text-font-size",element:"kaktusf-alert-text",cssOption:"font-size",cssType:"size"},"kaktusf-alert-text-font-weight":{data:"top",value:"alert_text_font_weight",input:"kaktusf-alert-text-font-weight",element:"kaktusf-alert-text",cssOption:"font-weight"},"kaktusf-alert-text-font-style":{data:"top",value:"alert_text_font_style",input:"kaktusf-alert-text-font-style",element:"kaktusf-alert-text",cssOption:"font-style"},"kaktusf-alert-text-line-height":{data:"top",value:"alert_text_line_height",input:"kaktusf-alert-text-line-height",element:"kaktusf-alert-text",cssOption:"line-height",cssType:"size"},"kaktusf-alert-prod-color":{data:"top",value:"alert_prod_color",input:"kaktusf-alert-prod-color",element:"kaktusf-alert-prod",cssOption:"color"},"kaktusf-alert-prod-font-size":{data:"top",value:"alert_prod_font_size",input:"kaktusf-alert-prod-font-size",element:"kaktusf-alert-prod",cssOption:"font-size",cssType:"size"},"kaktusf-alert-prod-font-weight":{data:"top",value:"alert_prod_font_weight",input:"kaktusf-alert-prod-font-weight",element:"kaktusf-alert-prod",cssOption:"font-weight"},"kaktusf-alert-prod-font-style":{data:"top",value:"alert_prod_font_style",input:"kaktusf-alert-prod-font-style",element:"kaktusf-alert-prod",cssOption:"font-style"},"kaktusf-alert-prod-line-height":{data:"top",value:"alert_prod_line_height",input:"kaktusf-alert-prod-line-height",element:"kaktusf-alert-prod",cssOption:"line-height",cssType:"size"}};const dataJsonMainSection={"kaktusf-bg-main":{data:"main",value:"background_main",input:"kaktusf-bg-main-input",element:"kaktusf-bg-main",cssOption:"background"},"kaktusf-bg-heading":{data:"main",value:"background_heading",element:"kaktusf-bg-heading",cssOption:"background"},"kaktusf-timer":{data:"main",value:"timer_bg",input:"kaktusf-timer-bg",element:"kaktusf-timer",cssOption:"background"},"kaktusf-timer-border-radius-left":{data:"main",value:"timer_border_radius",input:"kaktusf-timer-border-radius",element:"kaktusf-timer",cssOption:"border-bottom-left-radius",cssType:"size"},"kaktusf-timer-border-radius-right":{data:"main",value:"timer_border_radius",input:"kaktusf-timer-border-radius",element:"kaktusf-timer",cssOption:"border-bottom-right-radius",cssType:"size"},"kaktusf-timer-font-size":{data:"main",value:"timer_font_size",input:"kaktusf-timer-fs",element:"kaktusf-timer",cssOption:"font-size",cssType:"size"},"kaktusf-timer-color":{data:"main",value:"timer_color",input:"kaktusf-timer-color",element:"kaktusf-timer",cssOption:"color"},"kaktusf-timer-font-weight":{data:"main",value:"timer_font_weight",input:"kaktusf-timer-font-weight",element:"kaktusf-timer",cssOption:"font-weight"},"kaktusf-timer-font-style":{data:"main",value:"timer_font_style",input:"kaktusf-timer-font-style",element:"kaktusf-timer",cssOption:"font-style"},"kaktusf-timer-line-height":{data:"main",value:"timer_line_height",input:"kaktusf-timer-line-height",element:"kaktusf-timer",cssOption:"line-height",cssType:"size"},"kaktusf-title-font-size":{data:"main",value:"title_font_size",input:"kaktusf-title-fs",element:"kaktusf-title",cssOption:"font-size",cssType:"size"},"kaktusf-title-color":{data:"main",value:"title_color",input:"kaktusf-title-color",element:"kaktusf-title",cssOption:"color"},"kaktusf-title-font-weight":{data:"main",value:"title_font_weight",input:"kaktusf-title-font-weight",element:"kaktusf-title",cssOption:"font-weight"},"kaktusf-title-font-style":{data:"main",value:"title_font_style",input:"kaktusf-title-font-style",element:"kaktusf-title",cssOption:"font-style"},"kaktusf-title-line-height":{data:"main",value:"title_line_height",input:"kaktusf-title-line-height",element:"kaktusf-title",cssOption:"line-height",cssType:"size"},"kaktusf-description-font-size":{data:"main",value:"description_font_size",input:"kaktusf-description-fs",element:"kaktusf-description",cssOption:"font-size",cssType:"size"},"kaktusf-description-color":{data:"main",value:"description_color",input:"kaktusf-description-color",element:"kaktusf-description",cssOption:"color"},"kaktusf-description-font-weight":{data:"main",value:"description_font_weight",input:"kaktusf-description-font-weight",element:"kaktusf-description",cssOption:"font-weight"},"kaktusf-description-font-style":{data:"main",value:"description_font_style",input:"kaktusf-description-font-style",element:"kaktusf-description",cssOption:"font-style"},"kaktusf-description-line-height":{data:"main",value:"description_line_height",input:"kaktusf-description-line-height",element:"kaktusf-description",cssOption:"line-height",cssType:"size"},"kaktusf-border-width":{data:"main",value:"border_width",input:"kaktusf-border-size",element:"kaktusf-bd",cssOption:"border-width",cssType:"size"},"kaktusf-border-color":{data:"main",value:"border_color",input:"kaktusf-border-color",element:"kaktusf-bd",cssOption:"border-color"},"kaktusf-border-radius":{data:"main",value:"border_radius",input:"kaktusf-border-radius",element:"kaktusf-bd",cssOption:"border-radius",cssType:"size"},"kaktusf-border-radius-top":{data:"main",value:"border_radius",input:"w-border-radius",element:"kaktusf-bg-top",cssOption:"border-top-right-radius",cssType:"size"},"kaktusf-total-color":{data:"main",value:"total_color",input:"kaktusf-total-color",element:"kaktusf-total",cssOption:"color"},"kaktusf-total-font-size":{data:"main",value:"total_font_size",input:"kaktusf-total-font-size",element:"kaktusf-total",cssOption:"font-size",cssType:"size"},"kaktusf-total-font-weight":{data:"main",value:"total_font_weight",input:"kaktusf-total-font-weight",element:"kaktusf-total",cssOption:"font-weight"},"kaktusf-total-font-style":{data:"main",value:"total_font_style",input:"kaktusf-total-font-style",element:"kaktusf-total",cssOption:"font-style"},"kaktusf-total-line-height":{data:"main",value:"total_line_height",input:"kaktusf-total-line-height",element:"kaktusf-total",cssOption:"line-height",cssType:"size"},"kaktusf-total-price-color":{data:"main",value:"total_price_color",input:"kaktusf-total-price-color",element:"kaktusf-total-price",cssOption:"color"},"kaktusf-total-price-font-size":{data:"main",value:"total_price_font_size",input:"kaktusf-total-price-font-size",element:"kaktusf-total-price",cssOption:"font-size",cssType:"size"},"kaktusf-total-price-font-weight":{data:"main",value:"total_price_font_weight",input:"kaktusf-total-price-font-weight",element:"kaktusf-total-price",cssOption:"font-weight"},"kaktusf-total-price-font-style":{data:"main",value:"total_price_font_style",input:"kaktusf-total-price-font-style",element:"kaktusf-total-price",cssOption:"font-style"},"kaktusf-total-price-line-height":{data:"main",value:"total_price_line_height",input:"kaktusf-total-price-line-height",element:"kaktusf-total-price",cssOption:"line-height",cssType:"size"}};const dataJsonBottomSection={"kaktusf-background-bottom":{data:"bottom",value:"background_bottom",input:"kaktusf-bg-bottom-input",element:"kaktusf-bg-bottom",cssOption:"background"},"kaktusf-reject-btn-bd-radius":{data:"bottom",value:"reject_btn_border_radius",input:"kaktusf-reject-btn-bd-radius",element:"kaktusf-reject-btn",cssOption:"border-radius",cssType:"size"},"kaktusf-reject-btn-font-size":{data:"bottom",value:"reject_btn_font_size",input:"kaktusf-reject-btn-font-size",element:"kaktusf-reject-btn",cssOption:"font-size",cssType:"size"},"kaktusf-reject-btn-font-weight":{data:"bottom",value:"reject_btn_font_weight",input:"kaktusf-reject-btn-font-weight",element:"kaktusf-reject-btn",cssOption:"font-weight"},"kaktusf-reject-btn-font-style":{data:"bottom",value:"reject_btn_font_style",input:"kaktusf-reject-btn-font-style",element:"kaktusf-reject-btn",cssOption:"font-style"},"kaktusf-reject-btn-line-height":{data:"bottom",value:"reject_btn_line_height",input:"kaktusf-reject-btn-line-height",element:"kaktusf-reject-btn",cssOption:"line-height",cssType:"size"},"kaktusf-reject-btn-padding-top":{data:"bottom",value:"reject_btn_padding_t_b",input:"kaktusf-reject-btn-padding-t-b",element:"kaktusf-reject-btn",cssOption:"padding-top",cssType:"size"},"kaktusf-reject-btn-padding-bottom":{data:"bottom",value:"reject_btn_padding_t_b",input:"kaktusf-reject-btn-padding-t-b",element:"kaktusf-reject-btn",cssOption:"padding-bottom",cssType:"size"},"kaktusf-reject-btn-padding-left":{data:"bottom",value:"reject_btn_padding_l_r",input:"kaktusf-reject-btn-padding-l-r",element:"kaktusf-reject-btn",cssOption:"padding-left",cssType:"size"},"kaktusf-reject-btn-padding-right":{data:"bottom",value:"reject_btn_padding_l_r",input:"kaktusf-reject-btn-padding-l-r",element:"kaktusf-reject-btn",cssOption:"padding-right",cssType:"size"},"kaktusf-checkout-btn-bd-radius":{data:"bottom",value:"checkout_btn_border_radius",input:"kaktusf-checkout-btn-bd-radius",element:"kaktusf-checkout-btn",cssOption:"border-radius",cssType:"size"},"kaktusf-checkout-btn-font-size":{data:"bottom",value:"checkout_btn_font_size",input:"kaktusf-checkout-btn-font-size",element:"kaktusf-checkout-btn",cssOption:"font-size",cssType:"size"},"kaktusf-checkout-btn-font-weight":{data:"bottom",value:"checkout_btn_font_weight",input:"kaktusf-checkout-btn-font-weight",element:"kaktusf-checkout-btn",cssOption:"font-weight"},"kaktusf-checkout-btn-font-style":{data:"bottom",value:"checkout_btn_font_style",input:"kaktusf-checkout-btn-font-style",element:"kaktusf-checkout-btn",cssOption:"font-style"},"kaktusf-checkout-btn-line-height":{data:"bottom",value:"checkout_btn_line_height",input:"kaktusf-checkout-btn-line-height",element:"kaktusf-checkout-btn",cssOption:"line-height",cssType:"size"},"kaktusf-checkout-btn-padding-top":{data:"bottom",value:"checkout_btn_padding_t_b",input:"kaktusf-checkout-btn-padding-t-b",element:"kaktusf-checkout-btn",cssOption:"padding-top",cssType:"size"},"kaktusf-checkout-btn-padding-bottom":{data:"bottom",value:"checkout_btn_padding_t_b",input:"kaktusf-checkout-btn-padding-t-b",element:"kaktusf-checkout-btn",cssOption:"padding-bottom",cssType:"size"},"kaktusf-checkout-btn-padding-left":{data:"bottom",value:"checkout_btn_padding_l_r",input:"kaktusf-checkout-btn-padding-l-r",element:"kaktusf-checkout-btn",cssOption:"padding-left",cssType:"size"},"kaktusf-checkout-btn-padding-right":{data:"bottom",value:"checkout_btn_padding_l_r",input:"kaktusf-checkout-btn-padding-l-r",element:"kaktusf-checkout-btn",cssOption:"padding-right",cssType:"size"}};const dataJsonBtnStyle={"kaktusf-reject-btn-bg":{data:"bottom",value:"reject_btn_bg",secondValue:"reject_btn_bg_hover",input:"kaktusf-reject-btn-bg",inputHover:"kaktusf-reject-btn-bg-h",element:"kaktusf-reject-btn",cssOption:"background"},"kaktusf-reject-btn-color":{data:"bottom",value:"reject_btn_font_color",secondValue:"reject_btn_font_color_hover",input:"kaktusf-reject-btn-color",inputHover:"kaktusf-reject-btn-color-h",element:"kaktusf-reject-btn",cssOption:"color"},"kaktusf-reject-btn-color-icon":{data:"bottom",value:"reject_btn_font_color",secondValue:"reject_btn_font_color_hover",input:"kaktusf-reject-btn-color",inputHover:"kaktusf-reject-btn-color-h",element:"kaktusf-reject-btn",cssOption:"fill"},"kaktusf-checkout-btn-bg":{data:"bottom",value:"checkout_btn_bg",secondValue:"checkout_btn_bg_hover",input:"kaktusf-checkout-btn-bg",inputHover:"kaktusf-checkout-btn-bg-h",element:"kaktusf-checkout-btn",cssOption:"background"},"kaktusf-checkout-btn-color":{data:"bottom",value:"checkout_btn_font_color",secondValue:"checkout_btn_font_color_hover",input:"kaktusf-checkout-btn-color",inputHover:"kaktusf-checkout-btn-color-h",element:"kaktusf-checkout-btn",cssOption:"color"},"kaktusf-close-bg-color":{data:"top",value:"close_bg_color",secondValue:"close_bg_color_hover",input:"kaktusf-close-bg-color",inputHover:"kaktusf-close-bg-color-h",element:"kaktusf-close",cssOption:"background"},"kaktusf-close-color":{data:"top",value:"close_color",secondValue:"close_color_hover",input:"kaktusf-close-color",inputHover:"kaktusf-close-color-h",element:"kaktusf-close",cssOption:"color"},"kaktusf-cart-btn-bg":{data:"product",value:"cart_btn_bg",secondValue:"cart_btn_bg_hover",input:"kaktusf-cart-btn-bg",inputHover:"kaktusf-cart-btn-bg-h",element:"kaktusf-cart-btn",cssOption:"background"},"kaktusf-cart-btn-color":{data:"product",value:"cart_btn_font_color",secondValue:"cart_btn_font_color_hover",input:"kaktusf-cart-btn-color",inputHover:"kaktusf-cart-btn-color-h",element:"kaktusf-cart-btn",cssOption:"color"},"kaktusf-cart-btn-color-icon":{data:"product",value:"cart_btn_font_color",secondValue:"cart_btn_font_color_hover",input:"kaktusf-cart-btn-color",inputHover:"kaktusf-cart-btn-color-h",element:"kaktusf-cart-btn",cssOption:"fill"},"kaktusf-qty-btn-bg":{data:"product",value:"qty_btn_bg",secondValue:"qty_btn_bg_hover",input:"kaktusf-qty-btn-bg",inputHover:"kaktusf-qty-btn-bg-h",element:"kaktusf-qty-btn",cssOption:"background"},"kaktusf-qty-btn-color":{data:"product",value:"qty_btn_color",secondValue:"qty_btn_color_hover",input:"kaktusf-qty-btn-color",inputHover:"kaktusf-qty-btn-color-h",element:"kaktusf-qty-btn",cssOption:"color"},"kaktusf-remove-btn-bg":{data:"product",value:"remove_btn_bg",secondValue:"remove_btn_bg_hover",element:"kaktusf-remove-btn",cssOption:"background"},"kaktusf-remove-btn-color":{data:"product",value:"remove_btn_font_color",secondValue:"remove_btn_font_color_hover",element:"kaktusf-remove-btn",cssOption:"color"},"kaktusf-remove-btn-color-icon":{data:"product",value:"remove_btn_font_color",secondValue:"remove_btn_font_color_hover",element:"kaktusf-remove-btn",cssOption:"fill"}};const dataJsonProductStyle={"kaktusf-prod-bg-img":{data:"product",value:"background_img",input:"kaktusf-prod-bg-img",element:"kaktusf-product-item",cssOption:"background"},"kaktusf-prod-bg":{data:"product",value:"background",input:"kaktusf-prod-bg",element:"kaktusf-product-bg",cssOption:"background"},"kaktusf-cart-btn-bd-radius":{data:"product",value:"cart_btn_border_radius",input:"kaktusf-cart-btn-radius",element:"kaktusf-cart-btn",cssOption:"border-radius",cssType:"size"},"kaktusf-cart-btn-font-size":{data:"product",value:"cart_btn_font_size",input:"kaktusf-cart-btn-font-size",element:"kaktusf-cart-btn",cssOption:"font-size",cssType:"size"},"kaktusf-cart-btn-font-weight":{data:"product",value:"cart_btn_font_weight",input:"kaktusf-cart-btn-font-weight",element:"kaktusf-cart-btn",cssOption:"font-weight"},"kaktusf-cart-btn-font-style":{data:"product",value:"cart_btn_font_style",input:"kaktusf-cart-btn-font-style",element:"kaktusf-cart-btn",cssOption:"font-style"},"kaktusf-cart-btn-line-height":{data:"product",value:"cart_btn_line_height",input:"kaktusf-cart-btn-line-height",element:"kaktusf-cart-btn",cssOption:"line-height",cssType:"size"},"kaktusf-cart-btn-padding-top":{data:"product",value:"cart_btn_padding_t_b",input:"kaktusf-cart-btn-padding-t-b",element:"kaktusf-cart-btn",cssOption:"padding-top",cssType:"size"},"kaktusf-cart-btn-padding-bottom":{data:"product",value:"cart_btn_padding_t_b",input:"kaktusf-cart-btn-padding-t-b",element:"kaktusf-cart-btn",cssOption:"padding-bottom",cssType:"size"},"kaktusf-cart-btn-padding-left":{data:"product",value:"cart_btn_padding_l_r",input:"kaktusf-cart-btn-padding-l-r",element:"kaktusf-cart-btn",cssOption:"padding-left",cssType:"size"},"kaktusf-cart-btn-padding-right":{data:"product",value:"cart_btn_padding_l_r",input:"kaktusf-cart-btn-padding-l-r",element:"kaktusf-cart-btn",cssOption:"padding-right",cssType:"size"},"kaktusf-remove-btn-bd-radius":{data:"product",value:"remove_btn_border_radius",element:"kaktusf-remove-btn",cssOption:"border-radius",cssType:"size"},"kaktusf-remove-btn-font-size":{data:"product",value:"remove_btn_font_size",element:"kaktusf-remove-btn",cssOption:"font-size",cssType:"size"},"kaktusf-remove-btn-font-weight":{data:"product",value:"remove_btn_font_weight",element:"kaktusf-remove-btn",cssOption:"font-weight"},"kaktusf-remove-btn-font-style":{data:"product",value:"remove_btn_font_style",element:"kaktusf-remove-btn",cssOption:"font-style"},"kaktusf-remove-btn-line-height":{data:"product",value:"remove_btn_line_height",element:"kaktusf-remove-btn",cssOption:"line-height",cssType:"size"},"kaktusf-remove-btn-padding-top":{data:"product",value:"remove_btn_padding_t_b",element:"kaktusf-remove-btn",cssOption:"padding-top",cssType:"size"},"kaktusf-remove-btn-padding-bottom":{data:"product",value:"remove_btn_padding_t_b",element:"kaktusf-remove-btn",cssOption:"padding-bottom",cssType:"size"},"kaktusf-remove-btn-padding-left":{data:"product",value:"remove_btn_padding_l_r",element:"kaktusf-remove-btn",cssOption:"padding-left",cssType:"size"},"kaktusf-remove-btn-padding-right":{data:"product",value:"remove_btn_padding_l_r",element:"kaktusf-remove-btn",cssOption:"padding-right",cssType:"size"},"kaktusf-cart-border-width":{data:"product",value:"prod_border_width",input:"kaktusf-cart-border-size",element:"kaktusf-product-border",cssOption:"border-width",cssType:"size"},"kaktusf-cart-border-color":{data:"product",value:"prod_border_color",input:"kaktusf-cart-border-color",element:"kaktusf-product-border",cssOption:"border-color"},"kaktusf-cart-border-radius":{data:"product",value:"prod_border_radius",input:"kaktusf-cart-border-radius",element:"kaktusf-product-border",cssOption:"border-radius",cssType:"size"},"kaktusf-prod-title-color":{data:"product",value:"prod_title_color",input:"kaktusf-prod-title-color",element:"kaktusf-prod-title",cssOption:"color"},"kaktusf-prod-title-font-size":{data:"product",value:"prod_title_font_size",input:"kaktusf-prod-title-font-size",element:"kaktusf-prod-title",cssOption:"font-size",cssType:"size"},"kaktusf-prod-title-font-weight":{data:"product",value:"prod_title_font_weight",input:"kaktusf-prod-title-font-weight",element:"kaktusf-prod-title",cssOption:"font-weight"},"kaktusf-prod-title-font-style":{data:"product",value:"prod_title_font_style",input:"kaktusf-prod-title-font-style",element:"kaktusf-prod-title",cssOption:"font-style"},"kaktusf-prod-title-line-height":{data:"product",value:"prod_title_line_height",input:"kaktusf-prod-title-line-height",element:"kaktusf-prod-title",cssOption:"line-height",cssType:"size"},"kaktusf-prod-desc-color":{data:"product",value:"prod_desc_color",input:"kaktusf-prod-desc-color",element:"kaktusf-prod-desc",cssOption:"color"},"kaktusf-prod-desc-font-size":{data:"product",value:"prod_desc_font_size",input:"kaktusf-prod-desc-font-size",element:"kaktusf-prod-desc",cssOption:"font-size",cssType:"size"},"kaktusf-prod-desc-font-weight":{data:"product",value:"prod_desc_font_weight",input:"kaktusf-prod-desc-font-weight",element:"kaktusf-prod-desc",cssOption:"font-weight"},"kaktusf-prod-desc-font-style":{data:"product",value:"prod_desc_font_style",input:"kaktusf-prod-desc-font-style",element:"kaktusf-prod-desc",cssOption:"font-style"},"kaktusf-prod-desc-line-height":{data:"product",value:"prod_desc_line_height",input:"kaktusf-prod-desc-line-height",element:"kaktusf-prod-desc",cssOption:"line-height",cssType:"size"},"kaktusf-qty-background":{data:"product",value:"qty_background",input:"kaktusf-qty-bg",element:"kaktusf-qty-input",cssOption:"background"},"kaktusf-qty-border":{data:"product",value:"qty_btn_bg",input:"kaktusf-qty-btn-bg",element:"kaktusf-qty-input",cssOption:"border-color"},"kaktusf-qty-color":{data:"product",value:"qty_font_color",input:"kaktusf-qty-color",element:"kaktusf-qty-input",cssOption:"color"},"kaktusf-qty-border-radius-top":{data:"product",value:"qty_border_radius",input:"kaktusf-qty-border-radius",element:"kaktusf-qty-input",cssOption:"border-top-left-radius",cssType:"size"},"kaktusf-qty-border-radius-bottom":{data:"product",value:"qty_border_radius",input:"kaktusf-qty-border-radius",element:"kaktusf-qty-input",cssOption:"border-bottom-left-radius",cssType:"size"},"kaktusf-qty-border-radius-btn-top":{data:"product",value:"qty_border_radius",input:"kaktusf-qty-border-radius",element:"kaktusf-qty-btn-t",cssOption:"border-top-right-radius",cssType:"size"},"kaktusf-qty-border-radius-btn-bottom":{data:"product",value:"qty_border_radius",input:"kaktusf-qty-border-radius",element:"kaktusf-qty-btn-b",cssOption:"border-bottom-right-radius",cssType:"size"},"kaktusf-price-color":{data:"product",value:"price_color",input:"kaktusf-price-color",element:"kaktusf-price",cssOption:"color"},"kaktusf-price-font-size":{data:"product",value:"price_font_size",input:"kaktusf-price-font-size",element:"kaktusf-price",cssOption:"font-size",cssType:"size"},"kaktusf-price-font-weight":{data:"product",value:"price_font_weight",input:"kaktusf-price-font-weight",element:"kaktusf-price",cssOption:"font-weight"},"kaktusf-price-font-style":{data:"product",value:"price_font_style",input:"kaktusf-price-font-style",element:"kaktusf-price",cssOption:"font-style"},"kaktusf-price-line-height":{data:"product",value:"price_line_height",input:"kaktusf-price-line-height",element:"kaktusf-price",cssOption:"line-height",cssType:"size"},"kaktusf-compare-price-color":{data:"product",value:"compare_price_color",input:"kaktusf-compare-price-color",element:"kaktusf-compare-price",cssOption:"color"},"kaktusf-compare-price-font-size":{data:"product",value:"compare_price_font_size",input:"kaktusf-compare-price-font-size",element:"kaktusf-compare-price",cssOption:"font-size",cssType:"size"},"kaktusf-compare-price-font-weight":{data:"product",value:"compare_price_font_weight",input:"kaktusf-compare-price-font-weight",element:"kaktusf-compare-price",cssOption:"font-weight"},"kaktusf-compare-price-font-style":{data:"product",value:"compare_price_font_style",input:"kaktusf-compare-price-font-style",element:"kaktusf-compare-price",cssOption:"font-style"},"kaktusf-compare-price-line-height":{data:"product",value:"compare_price_line_height",input:"kaktusf-compare-price-line-height",element:"kaktusf-compare-price",cssOption:"line-height",cssType:"size"},"kaktusf-save-background-color":{data:"product",value:"save_bg",input:"kaktusf-save-bg",element:"kaktusf-save-label",cssOption:"background"},"kaktusf-save-border-radius":{data:"product",value:"save_border_radius",input:"kaktusf-save-border-radius",element:"kaktusf-save-label",cssOption:"border-radius",cssType:"size"},"kaktusf-save-color":{data:"product",value:"save_color",input:"kaktusf-save-color",element:"kaktusf-save-label",cssOption:"color"},"kaktusf-save-font-size":{data:"product",value:"save_font_size",input:"kaktusf-save-font-size",element:"kaktusf-save-label",cssOption:"font-size",cssType:"size"},"kaktusf-save-font-weight":{data:"product",value:"save_font_weight",input:"kaktusf-save-font-weight",element:"kaktusf-save-label",cssOption:"font-weight"},"kaktusf-save-font-style":{data:"product",value:"save_font_style",input:"kaktusf-save-font-style",element:"kaktusf-save-label",cssOption:"font-style"},"kaktusf-save-line-height":{data:"product",value:"save_line_height",input:"kaktusf-save-line-height",element:"kaktusf-save-label",cssOption:"line-height",cssType:"size"},"kaktusf-save-padding":{data:"product",value:"save_padding",input:"kaktusf-save-padding",element:"kaktusf-save-label",cssOption:"padding",cssType:"size"},"kaktusf-variations-bg":{data:"product",value:"variations_background",input:"kaktusf-variations-bg",element:"kaktusf-variations",cssOption:"background-color"},"kaktusf-variations-color":{data:"product",value:"variations_font_color",input:"kaktusf-variations-color",element:"kaktusf-variations",cssOption:"color"},"kaktusf-variations-border-widrh":{data:"product",value:"variations_border_width",input:"kaktusf-variations-border-size",element:"kaktusf-variations",cssOption:"border-width",cssType:"size"},"kaktusf-variations-border-color":{data:"product",value:"variations_border_color",input:"kaktusf-variations-border-color",element:"kaktusf-variations",cssOption:"border-color",},"kaktusf-variations-border-radius":{data:"product",value:"variations_border_radius",input:"kaktusf-variations-border-radius",element:"kaktusf-variations",cssOption:"border-radius",cssType:"size"}};const dataShowHide={"kaktusf-close":{data:"top",value:"close_show",input:"kaktusf-close-show",element:"kaktusf-close"},"kaktusf-alert-text":{data:"top",value:"alert_text_show",input:"kaktusf-alert-text-show",element:"kaktusf-alert-text"},"kaktusf-alert-prod":{data:"top",value:"alert_prod_show",input:"kaktusf-alert-prod-show",element:"kaktusf-alert-prod"},"kaktusf-alert-prod-img":{data:"top",value:"alert_prod_show",input:"kaktusf-alert-prod-show",element:"kaktusf-popup__cart-alert--img"},"kaktusf-timer":{data:"main",value:"timer_show",input:"kaktusf-timer-show",element:"kaktusf-timer"},"kaktusf-title":{data:"main",value:"title_show",input:"kaktusf-title-show",element:"kaktusf-title"},"kaktusf-description":{data:"main",value:"description_show",input:"kaktusf-description-show",element:"kaktusf-description"},"kaktusf-total":{data:"main",value:"total_show",input:"kaktusf-total-show",element:"kaktusf-total"},"kaktusf-total-price":{data:"main",value:"total_price_show",input:"kaktusf-total-price-show",element:"kaktusf-total-price"},"kaktusf-reject-btn":{data:"bottom",value:"reject_btn_show",input:"kaktusf-reject-btn-show",element:"kaktusf-reject-btn"},"kaktusf-checkout-btn":{data:"bottom",value:"checkout_btn_show",input:"kaktusf-checkout-btn-show",element:"kaktusf-checkout-btn"},"kaktusf-prod-title":{data:"product",value:"prod_title_show",input:"kaktusf-prod-title-show",element:"kaktusf-prod-title"},"kaktusf-prod-desc":{data:"product",value:"prod_desc_show",input:"kaktusf-prod-desc-show",element:"kaktusf-prod-desc"},"kaktusf-price":{data:"product",value:"price_show",input:"kaktusf-price-show",element:"kaktusf-price"},"kaktusf-compare-price":{data:"product",value:"compare_price_show",input:"kaktusf-compare-price-show",element:"kaktusf-compare-price"},"kaktusf-save":{data:"product",value:"save_show",input:"kaktusf-save-show",element:"kaktusf-save-label"},"kaktusf-qty":{data:"product",value:"qty_show",input:"kaktusf-qty-show",element:"kaktusf-qty"},"kaktusf-variations":{data:"product",value:"variations_show",input:"kaktusf-variations-show",element:"kaktusf-variations-wrap"},"kaktusf-top-show":{data:"top",value:"top_show",input:"kaktusf-top-show",element:"kaktusf-bg-top"}};function fillWidget(data){const widgetJson=data.design;const cartBtnText=getAppSelectorAll('.kaktusf-cart-btn-text');const cartBtnTextAdded=getAppSelectorAll('.kaktusf-cart-btn-added-text');const cartBtn=getAppSelectorAll('.kaktusf-cart-btn');const beforeAlert=getAppSelector('.kaktusf-before-alert');const type=widgetJson.widget_type;switch(type){case offerTypes.crossSell:case offerTypes.postPurchase:case offerTypes.discount:case offerTypes.exitIntent:case offerTypes.cartPage:case offerTypes.beforeCheckout:case offerTypes.homePage:cartBtnText.forEach((element)=>element.classList.remove(`kaktusf-cart-btn-text-upsell`));cartBtnTextAdded.forEach((element)=>element.classList.remove(`kaktusf-cart-btn-added-text-upsell`));cartBtn.forEach((element)=>element.setAttribute('data-cart','add'));if(beforeAlert){beforeAlert.classList.remove(`kaktusf-alert-upsell`);}
break;case offerTypes.upsell:cartBtnText.forEach((element)=>element.classList.add(`kaktusf-cart-btn-text-upsell`));cartBtnTextAdded.forEach((element)=>element.classList.add(`kaktusf-cart-btn-added-text-upsell`));cartBtn.forEach((element)=>element.setAttribute('data-cart','replace'));if(beforeAlert){beforeAlert.classList.add(`kaktusf-alert-upsell`);}
break;}
getObjJsonKeys(widgetJson,dataJsonTopSection);getObjJsonKeys(widgetJson,dataJsonMainSection);getObjJsonKeys(widgetJson,dataJsonBottomSection);getObjJsonKeys(widgetJson,dataJsonProductStyle);getObjJsonKeys(widgetJson,dataJsonBtnStyle,"btn");getObjJsonKeys(widgetJson,dataShowHide,"show");setProductDescription(widgetJson);const timerShow=widgetJson.main.timer_show;const timerMin=widgetJson.main.timer_min;const timerSeconds=widgetJson.main.timer_sec;const display=getAppSelector('.kaktusf-countdown__time');buildTimer(timerMin,timerSeconds,display);if(timerShow){startTimer(true,timerMin,timerSeconds,display);}
const wallpaper=widgetJson.main.wallpaper;const wallpaperDiv=getAppSelector('.kaktusf-wallpaper');let wallpaperVal;if(wallpaper=='wallpaper_0'){wallpaperVal='transparent';}else{const coverWallpaper=['wallpaper_20','wallpaper_21','wallpaper_22','wallpaper_23','wallpaper_24','wallpaper_25','wallpaper_26'];if(coverWallpaper.includes(wallpaper)){wallpaperDiv.classList.add('cover');}else{wallpaperDiv.classList.remove('cover');}
wallpaperDiv.style.display='block';wallpaperVal=`url("${kaktusfbaseUrl}assets/images/widgets/wallpapers/${wallpaper}.png")`;}
wallpaperDiv.style.background=wallpaperVal;const custom_css=widgetJson.custom_css;const customCssDiv=getAppSelector('#kaktusf-custom-css');if(custom_css){customCssDiv.innerText=custom_css;}else{customCssDiv.innerText='';}
const prodDesc=getAppSelectorAll('.kaktusf-desc-short');prodDesc.forEach((element)=>{let str=element.innerText.trim();if(str.length>100){let trimmedStr=str.substring(0,100)+"...";element.innerText=trimmedStr;}});}
function fillWidgetFunnel(data){const cartBtnText=getAppSelectorAll('.kaktusf-cart-btn-text');const cartBtnTextAdded=getAppSelectorAll('.kaktusf-cart-btn-added-text');const cartBtn=getAppSelectorAll('.kaktusf-cart-btn');const beforeAlert=getAppSelector('.kaktusf-before-alert');const productWrapp=getAppSelector('.kaktusf-product__wrapp');const productItem=getAppSelectorAll('.kaktusf-product__item');const widgetJson=data,layout=widgetJson.design_type.layout,layout_col=widgetJson.design_type.layout_col
const type=widgetJson.widget_type;switch(type){case offerTypes.crossSell:case offerTypes.postPurchase:case offerTypes.discount:case offerTypes.exitIntent:case offerTypes.cartPage:case offerTypes.beforeCheckout:case offerTypes.homePage:cartBtnText.forEach((element)=>element.classList.remove(`kaktusf-cart-btn-text-upsell`));cartBtnTextAdded.forEach((element)=>element.classList.remove(`kaktusf-cart-btn-added-text-upsell`));cartBtn.forEach((element)=>element.setAttribute('data-cart','add'));if(beforeAlert){beforeAlert.classList.remove(`kaktusf-alert-upsell`);}
break;case offerTypes.upsell:cartBtnText.forEach((element)=>element.classList.add(`kaktusf-cart-btn-text-upsell`));cartBtnTextAdded.forEach((element)=>element.classList.add(`kaktusf-cart-btn-added-text-upsell`));cartBtn.forEach((element)=>element.setAttribute('data-cart','replace'));if(beforeAlert){beforeAlert.classList.add(`kaktusf-alert-upsell`);}
break;}
getObjJsonKeys(widgetJson,dataJsonProductStyle);getObjJsonKeys(widgetJson,dataJsonBtnStyle,"btn");getObjJsonKeys(widgetJson,dataShowHide,"show");setProductDescription(widgetJson)
const timerShow=widgetJson.main.timer_show;const timerMin=widgetJson.main.timer_min;const timerSeconds=widgetJson.main.timer_sec;const display=getAppSelector('.kaktusf-countdown__time');buildTimer(timerMin,timerSeconds,display);startTimer(false);if(timerShow){startTimer(true,timerMin,timerSeconds,display);}
if(widgetJson.widget_type!=offerTypes.slider||widgetJson.design_type.layout!="fbt"){productWrapp.classList.remove('kaktusf-product--grid','kaktusf-product--list','kaktusf-product--metro','kaktusf-grid-item-2','kaktusf-grid-item-3','kaktusf-grid-item-4');productItem.forEach((element)=>element.classList.remove('kaktusf-product__item--grid','kaktusf-product__item--list','kaktusf-product__item--metro'));if(layout){productWrapp.classList.add(`kaktusf-product--${layout}`,`kaktusf-${layout_col}`);productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--${layout}`));}else{productWrapp.classList.add('kaktusf-product--grid','kaktusf-grid-item-2');productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--grid`));}}
const prodDesc=getAppSelectorAll('.kaktusf-desc-short');prodDesc.forEach((element)=>{let str=element.innerText.trim();if(str.length>100){let trimmedStr=str.substring(0,100)+"...";element.innerText=trimmedStr;}});}
function fillWidgetSettings(data){const kaktusfPopup=getAppSelector('.kaktusf-popup');const kaktusfWrap=getAppSelector('.kaktusf-popup__wrap');const kaktusfBody=getAppSelector('.kaktusf-popup__body');const productWrapp=getAppSelector('.kaktusf-product__wrapp');const widgetJson=data.design,position=widgetJson.design_type.position,animation=widgetJson.design_type.animation,layout=widgetJson.design_type.layout,layout_col=widgetJson.design_type.layout_col?widgetJson.design_type.layout_col:'grid-item-2',widgetWidth=widgetJson.design_type.widget_width;if(kaktusfPopup){kaktusfPopup.classList.remove('kaktusf-popup__position--full','kaktusf-popup__position--right_bottom','kaktusf-popup__position--left_bottom','kaktusf-popup__position--bottom','kaktusf-popup__position--top','kaktusf-popup__position--center');kaktusfPopup.classList.add(`kaktusf-popup__position--${position}`);kaktusfPopup.classList.remove("kaktusf-hide");kaktusfWrap.setAttribute('class','kaktusf-popup__wrap');kaktusfWrap.classList.add(`animate__animated`,`${animation}`);}
if(widgetJson.widget_type!=offerTypes.slider&&widgetJson.design_type.layout!="fbt"){productWrapp.classList.remove('kaktusf-product--grid','kaktusf-product--list','kaktusf-product--metro','kaktusf-grid-item-2','kaktusf-grid-item-3','kaktusf-grid-item-4');const productItem=getAppSelectorAll('.kaktusf-product__item');productItem.forEach((element)=>element.classList.remove('kaktusf-product__item--grid','kaktusf-product__item--list','kaktusf-product__item--metro'));if(layout){productWrapp.classList.add(`kaktusf-product--${layout}`,`kaktusf-${layout_col}`);productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--${layout}`));}else{productWrapp.classList.add('kaktusf-product--grid','kaktusf-grid-item-2');productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--grid`));}
kaktusfBody.classList.remove('kaktusf-width-container','kaktusf-width-full');kaktusfBody.classList.add(`kaktusf-width-${widgetWidth}`);}else{const productItem=getAppSelectorAll('.kaktusf-product__item');productItem.forEach((element)=>element.classList.remove('kaktusf-product__item--grid','kaktusf-product__item--list','kaktusf-product__item--metro'));if(layout){productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--${layout}`));}else{productWrapp.classList.add('kaktusf-product--grid','kaktusf-grid-item-2');productItem.forEach((element)=>element.classList.add(`kaktusf-product__item--grid`));}
kaktusfBody.classList.remove('kaktusf-width-container','kaktusf-width-full');kaktusfBody.classList.add(`kaktusf-width-${widgetWidth}`);}}
function getObjJsonKeys(widgetJson,obj,type){for(let key in obj){if(type==="show"){setShowHide(widgetJson,obj[key].data,obj[key].value,obj[key].element);}else if(type==="btn"){setJsonDataBtn(widgetJson,obj[key].data,obj[key].value,obj[key].secondValue,obj[key].element,obj[key].cssOption);}else{setJsonData(widgetJson,obj[key].data,obj[key].value,obj[key].element,obj[key].cssOption,obj[key].cssType);}}}
function setJsonData(widgetJson,obj,value,element,styleOpt,type){const option=widgetJson[obj][value];let inputOption=option;if(option==null)return;if(styleOpt==="border-top-right-radius"&&element===".kaktusf-bg-top"&&inputOption!=0){inputOption=+inputOption+3;}
if(type==="size"){inputOption=inputOption+'px';}
const elements=getAppSelectorAll('.'+element);elements.forEach((element)=>{element.style[styleOpt]=inputOption;})}
function setJsonDataBtn(widgetJson,obj,value,value_2,element,styleOpt){const option=widgetJson[obj][value];const option_2=widgetJson[obj][value_2];let btn;if(option==null)return;let inputOption=option;btn=inputOption;let inputOption_2=option_2;const elements=getAppSelectorAll('.'+element);elements.forEach((element)=>{element.style[styleOpt]=inputOption;element.addEventListener("mouseover",function(){this.style[styleOpt]=inputOption_2;},false);element.addEventListener("mouseout",function(){this.style[styleOpt]=btn;},false);})}
function setShowHide(widgetJson,obj,value,element){const option=widgetJson[obj][value];if(option==null)return;const elements=getAppSelectorAll('.'+element);elements.forEach((element)=>{if(option){element.classList.remove('kaktusf-hide');}else{element.classList.add('kaktusf-hide');}})}
function setProductDescription(widgetJson){const option=widgetJson['product']['prod_desc_show_full'];if(option==null)return;const shortDescription=getAppSelectorAll('.kaktusf-desc-short');const fullDescription=getAppSelectorAll('.kaktusf-desc-full');shortDescription.forEach((element)=>{if(option){element.classList.add('kaktusf-hide');}else{element.classList.remove('kaktusf-hide');}})
fullDescription.forEach((element)=>{if(option){element.classList.remove('kaktusf-hide');}else{element.classList.add('kaktusf-hide');}})}
function showFunnel(funnelObj,triggerType){const offerType=funnelObj.offer_type;if(offerType!=offerTypes.upsell){maxProductNumber=funnelObj.max_products_number;currentProductNumber=0;}
offerId=funnelObj.id;const productsDiv=getAppSelector('.kaktusf-popup__products');const targetDiv=getAppSelector('.kaktusf-popup__body');targetDiv.querySelector('.kaktusf-popup__products').classList.add('kaktusf-preload');targetDiv.querySelector('.kaktusf-product__wrapp').innerHTML='';const product_data=funnelObj.products;const accepted_click_add_to_cart=funnelObj.accepted_click_add_to_cart;const offerTexts={'title':funnelObj.title,'allow_set_description':funnelObj.allow_set_description,'description':funnelObj.description}
for(let key in product_data){if(product_data.hasOwnProperty(key)){for(const[i,value]of Object.entries(product_data[key])){const productArray=JSON.parse(JSON.stringify(allProducts));const min_qty=allDiscounts[funnelObj.id][key].min_qty;const discount=allDiscounts[funnelObj.id][key].discount;const discount_type=allDiscounts[funnelObj.id][key].discount_type;productArray[value].discount_type=typeof discount_type!=undefined?discount_type:null;productArray[value].discount=typeof discount!=undefined?discount:null;productArray[value].min_quantity=typeof min_qty!=undefined?min_qty:null;fillWidgetProduct(productArray[value],accepted_click_add_to_cart,triggerType,funnelObj.popup_type);}}}
showRemoveButton(productsDiv);fillWidgetFunnel(widgetDesign);changeWidgetText(targetDiv,offerTexts);setTimeout(function(){productsDiv.classList.remove('kaktusf-preload');},500);funnelsObj=funnelObj.child?funnelObj.child:null;}
function buildTimer(minutes,seconds,display){display.innerHTML="";minutes=parseInt(minutes);seconds=parseInt(seconds);seconds=seconds<10?"0"+seconds:seconds;minutes=minutes<10?"0"+minutes:minutes;display.innerText=minutes+":"+seconds;}
function startTimer(flag,minutes,seconds,display){if(flag)
countDown=setInterval(function(){minutes=parseInt(minutes)
seconds=parseInt(seconds)
if(+seconds===0){if(+minutes===0){clearInterval(countDown);removeAppContainer();sendStatistic(offerId);statisticArr.length=0;if(currentTriggerType===triggerTypes.buyItNow||currentTriggerType===triggerTypes.beforeCheckout){setTimeout(()=>{createOrder();},1000);}else if(pageReload){setTimeout(()=>{cartReload();},1000);}}else{minutes--;seconds=59;}}
seconds=seconds<10?"0"+seconds:seconds;minutes=minutes<10?"0"+minutes:minutes;display.innerText=minutes+":"+seconds;seconds--;},1000);else
clearInterval(countDown);}
function restartTimer(){let isTimerDeactive=getAppSelector('.kaktusf-timer').classList.contains('kaktusf-hide');if(isTimerDeactive)return;const display=getAppSelector('.kaktusf-countdown__time');const timerMin=display.innerText.split(':')[0];const timerSeconds=display.innerText.split(':')[1];startTimer(true,timerMin,timerSeconds,display);}
async function fetchCart(){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch("/cart.json",options);return await resp.json();}
async function addItem(variantId,quantity,properties={}){const options={method:'POST',headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify({id:variantId,quantity:quantity,properties:properties})};const url="/cart/add.json";const resp=await fetch(url,options);return await resp.json();}
async function removeItem(data){const options={method:'POST',headers:{"Content-Type":"application/json","Accept":"application/json"},body:JSON.stringify({...data,quantity:0})};const url="/cart/change.js";const resp=await fetch(url,options);return await resp.json();}
function removeItemById(id){return removeItem({id:`${id}`});}
function removeItemByLine(oneBasedLineIndex){return removeItem({line:oneBasedLineIndex});}
async function fetchPage(url){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch(`${url}.json`,options);return await resp.json();}
async function fetchProduct(handle){const options={method:'GET',headers:{"Content-Type":"application/json","Accept":"application/json"}};const resp=await fetch(`/products/${handle}.json`,options);return resp.json();}
async function offerFetchPrewiev(offerParams){setExcludeOffers();getExcludeCartOffer();const options={headers:{'Content-Type':'application/json',"Accept":"application/json"}};const domain=kaktusfShop;const product_id=offerParams.productId?`&product_id=${offerParams.productId}`:'';const params=new URLSearchParams(window.location.search)
const main_offer_id=params.get('offerId');let url=kaktusfApiUrl+`api/front/offers/popup-data?domain=${domain}${product_id}&main_offer_id=${main_offer_id}`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
async function offerFetch(offerParams){setExcludeOffers();getExcludeCartOffer();const options={headers:{'Content-Type':'application/json',"Accept":"application/json"}};const domain=kaktusfShop;const product_id=offerParams.productId?`&product_id=${offerParams.productId}`:'';const variants_id=offerParams.variantsId?`&variants_id=${offerParams.variantsId}`:'';const trigger_event=offerParams.triggerType;const display_on_device=window.innerWidth>991?'3':'2';const cart_value=offerParams.cartValue?offerParams.cartValue:0;const page_id=trigger_event==='4'?`&page_select=${offerParams.targetCode}`:'';const button_code=trigger_event==='5'?`&button_code=${encodeURIComponent(offerParams.targetCode)}`:'';const logged_user=(typeof ShopifyAnalytics!=='undefined'&&ShopifyAnalytics.meta.page.customerId)?'1':'0';const exclude_offers=excludeOffers.length?`&exclude_offers=${excludeOffers.join(',')}`:'';const cart=offerParams.cart?offerParams.cart:0;currentTriggerType=trigger_event;let kaktusfUrl=getCookie('kaktusfUrl');let parameter='';if(kaktusfUrl){parameter=kaktusfUrl;}
const url_parameter=parameter?`&url_parameter=${encodeURIComponent(parameter)}`:'';let url=kaktusfApiUrl+`api/front/offers?domain=${domain}${product_id}${variants_id}&cart=${cart}&trigger_event=${trigger_event}&display_on_device=${display_on_device}&cart_value=${cart_value}&logged_user=${logged_user}${page_id}${button_code}${url_parameter}${exclude_offers}`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
async function createStatisticFetch(main_offer_id,offer_id,addedToCart,funnelViews){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createStatisticRequest(main_offer_id,offer_id,addedToCart,funnelViews))};let url=kaktusfApiUrl+`api/front/statistic`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.text();}
function createStatisticRequest(main_offer_id,offer_id,addedToCart,views){const domain=kaktusfShop;const action=addedToCart?'accept':'decline';return{domain:domain,main_offer_id:main_offer_id,offer_id:offer_id,action:action,views:views}}
function sendStatistic(offerId,funnelAction=false){if(statisticArr.includes(offerId)){const offerIdsArr=statisticArr.filter(element=>element===offerId);let funnelViews;if(funnelAction){funnelViews=offerIdsArr.length>1?0:1;}else{funnelViews=offerIdsArr.length>=1?0:1;}
createStatisticFetch(mainOfferId,offerId,funnelAction,funnelViews);}else{createStatisticFetch(mainOfferId,offerId,funnelAction,1);}}
async function createPurchaseFetch(data){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createPurchaseRequest(data))};let url=kaktusfApiUrl+`api/front/purchase`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.text();}
function createPurchaseRequest(data){const domain=kaktusfShop;const main_offer_id=data.main_offer_id;const amount=[];data.offer_amount.forEach(item=>{amount.push({offer_id:item.offer_id,amount:item.amount})});return{domain:domain,main_offer_id:main_offer_id,offer_amount:amount}}
function createPurchaseData(variantId,propertyId,storePrice){const localOfferData=localStorage.getItem('kaktusfPurchaseData');purchaseData=localOfferData?JSON.parse(localOfferData):purchaseData;let offerData={'main_offer_id':mainOfferId,'offer':[]}
if(purchaseData.length){const checkMainOfferId=purchaseData.find(item=>item.main_offer_id===mainOfferId);if(checkMainOfferId){setOfferData(checkMainOfferId);}else{purchaseData.push(offerData);setOfferData(offerData);}}else{purchaseData.push(offerData)
setOfferData(offerData);}
function setOfferData(data){data.offer.push({offer_id:offerId,product_id:variantId,property_id:propertyId,product_store_price:storePrice})}
localStorage.setItem('kaktusfPurchaseData',JSON.stringify(purchaseData));}
const s_ajaxListener=new Object();s_ajaxListener.tempOpen=XMLHttpRequest.prototype.open;s_ajaxListener.tempSend=XMLHttpRequest.prototype.send;s_ajaxListener.callback=function(){let thisUrl=this.url.replace(/\?(.+)/ig,"");if(thisUrl.includes('/cart/add')){const triggerType=triggerTypes.addToCart;let dataStr,variantsId;if(typeof(this.data)==='object'){if(this.data instanceof FormData){for(let pair of this.data.entries()){if(pair[0]==='id'){variantsId=pair[1];}}}}else if(typeof(this.data)==='string'){if(this.data.includes('&')){dataStr=this.data.split('&');dataStr.forEach(element=>{if(element.includes('id=')){variantsId=element.split('=');variantsId=variantsId[variantsId.length-1];}});}else if(this.data.includes('{')){dataStr=JSON.parse(this.data);variantsId=dataStr.id?dataStr.id:dataStr.items[0].id;}}
currentProductId=variantsId;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){if(location.href.includes('/products/')){addToCartProductPage(triggerType,variantsId,currentProductId);}else{addToCartTrigger(triggerType,variantsId,currentProductId);}}}
if(thisUrl.includes('/cart/change')){setTimeout(()=>{removeFunnelProducts();checkBundleProducts();},500);}}
XMLHttpRequest.prototype.open=function(a,b){if(!a)var a='';if(!b)var b='';s_ajaxListener.tempOpen.apply(this,arguments);s_ajaxListener.method=a;s_ajaxListener.url=b;if(a.toLowerCase()=='get'){s_ajaxListener.data=b.split('?');s_ajaxListener.data=s_ajaxListener.data[1];}}
XMLHttpRequest.prototype.send=function(a,b){if(!a)var a='';if(!b)var b='';s_ajaxListener.tempSend.apply(this,arguments);if(s_ajaxListener.method.toLowerCase()=='post')s_ajaxListener.data=a;s_ajaxListener.callback();}
const nativeFetch=window.fetch;window.fetch=async function(...args){let thisUrl=args[0].replace(/\?(.+)/ig,"");if(thisUrl.includes('/cart/add')){if(typeof args[1].body==='string'&&(args[1].body.includes('offer')||triggerProduct)){triggerProduct=false;return nativeFetch.apply(window,args);}
let response=await nativeFetch.apply(window,args);if(response.status===200){const triggerType=triggerTypes.addToCart;let dataArgs,variantsId;if(typeof(args[1].body)==='object'&&args[1].body instanceof FormData){for(let pair of args[1].body.entries()){if(pair[0]==='id'){variantsId=pair[1];}}}else if(typeof(args[1].body)==='string'){if(args[1].body.includes('&')){dataArgs=args[1].body.split('&');dataArgs.forEach(element=>{if(element.includes('id=')){variantsId=element.split('=');variantsId=variantsId[variantsId.length-1];}});}else if(args[1].body.includes('{')){dataArgs=JSON.parse(args[1].body);variantsId=dataArgs.id?dataArgs.id:dataArgs.items[0].id;}}else{return response;}
currentProductId=variantsId;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){if(location.href.includes('/products/')){addToCartProductPage(triggerType,variantsId,currentProductId);}else{addToCartTrigger(triggerType,variantsId,currentProductId);}}}
return response}else if(thisUrl.includes('/cart/change')){let response=await nativeFetch.apply(window,args);if(response.status===200){removeFunnelProducts();checkBundleProducts();}
return response}else{return nativeFetch.apply(window,args);}}
function addToCartProductPage(triggerType,variantsId,currentProductId){let url=location.href.split('/');let productsIndex=url.indexOf('products');url=url[productsIndex+1];fetchProduct(url).then(function(dataPage){const productId=dataPage.product.id;fetchCart().then(function(dataCart){let cart;if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,productId,variantsId,cart,cartValue:dataCart.total_price}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}});});})}
function addToCartTrigger(triggerType,variantsId,currentProductId){fetchCart().then(function(dataCart){const targetProduct=dataCart.items.find(item=>parseInt(item.id)===parseInt(variantsId));if(!targetProduct){addToCartTrigger(triggerType,variantsId,currentProductId);return false;}
const productId=targetProduct.product_id;let cart;if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,productId,variantsId,cart,cartValue:dataCart.total_price}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}});});}
function removeFunnelProducts(){if(kaktusfRemoveFunnelProducts===1)return;const removeProduct=2;const removeDiscount=3;fetchCart().then(function(dataCart){updateProductsData(dataCart);const localProductsData=JSON.parse(localStorage.getItem('kaktusfProductsData'));if(localProductsData){localProductsData.forEach((element,index)=>{if(dataCart.items.length){const lineItemProperty=dataCart.items.find(product=>+product.id===+element.targetProductId&&!product.properties.offer);if(lineItemProperty)return;if(kaktusfRemoveFunnelProducts===removeProduct){for(let i=0;i<dataCart.items.length;i++){const isFunnelProduct=element.funnelProducts.find(item=>item.propertyId===dataCart.items[i].properties.offer);if(isFunnelProduct){removeItemByLine(i+1);break;}}}else if(kaktusfRemoveFunnelProducts===removeDiscount){const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));for(let i=0;i<element.funnelProducts.length;i++){const isFunnelProduct=localDataOrder.find(item=>item.propertyId===element.funnelProducts[i].propertyId);if(isFunnelProduct){isFunnelProduct.discountType=null;isFunnelProduct.discountValue=null;}}
localProductsData.splice(index,1);localStorage.setItem('kaktusDataOrder',JSON.stringify(localDataOrder));localStorage.setItem('kaktusfProductsData',JSON.stringify(localProductsData));}else{return;}}});}else{return;}});}
function updateProductsData(dataCart){const localProductsData=JSON.parse(localStorage.getItem('kaktusfProductsData'));if(!localProductsData)return;if(dataCart.items.length<1||localProductsData.length<1){localStorage.removeItem('kaktusfProductsData');}else{localProductsData.forEach((element,i)=>{if(element.funnelProducts.length){element.funnelProducts.forEach((funnelProduct,index)=>{const isFunnelProduct=dataCart.items.find(item=>item.properties.offer===funnelProduct.propertyId);if(!isFunnelProduct){element.funnelProducts.splice(index,1);}})}else{localProductsData.splice(i,1);}})
localStorage.setItem('kaktusfProductsData',JSON.stringify(localProductsData));}}
function checkBundleProducts(){const localBundleData=JSON.parse(localStorage.getItem('kaktusfBundleData'));if(!localBundleData||kaktusfRemoveFunnelProducts===1)return;const removeProduct=2;const removeDiscount=3;fetchCart().then(function(dataCart){updateBundleData(dataCart,localBundleData);const updatedBundleData=JSON.parse(localStorage.getItem('kaktusfBundleData'));if(!updatedBundleData)return;updatedBundleData.forEach((bundleSet,index)=>{if(kaktusfRemoveFunnelProducts===removeProduct){for(let i=0;i<bundleSet.bundleProducts.length;i++){const isProduct=dataCart.items.find(item=>item.properties.offer===bundleSet.bundleProducts[i].propertyId);if(!isProduct){removeBundleGroup(dataCart,bundleSet);break;}}}else if(kaktusfRemoveFunnelProducts===removeDiscount){const localDataOrder=JSON.parse(localStorage.getItem('kaktusDataOrder'));for(let i=0;i<bundleSet.bundleProducts.length;i++){const isProduct=localDataOrder.find(item=>item.propertyId===bundleSet.bundleProducts[i].propertyId);if(isProduct){isProduct.discountType=null;isProduct.discountValue=null;}}
updatedBundleData.splice(index,1);localStorage.setItem('kaktusDataOrder',JSON.stringify(localDataOrder));localStorage.setItem('kaktusfBundleData',JSON.stringify(updatedBundleData));}else{return;}});});}
function removeBundleGroup(dataCart,bundleSet){for(let i=0;i<dataCart.items.length;i++){const isBundleProduct=bundleSet.bundleProducts.find(item=>item.propertyId===dataCart.items[i].properties.offer);if(isBundleProduct){removeItemByLine(i+1);break;}}}
function updateBundleData(dataCart,localBundleData){if(dataCart.items.length<1||localBundleData.length<1){localStorage.removeItem('kaktusfBundleData');}else{localBundleData.forEach((bundleSet,index)=>{for(let i=0;i<bundleSet.bundleProducts.length;i++){const isBundleProduct=dataCart.items.find(item=>item.properties.offer===bundleSet.bundleProducts[i].propertyId);if(isBundleProduct)break;if(bundleSet.bundleProducts.length===i+1&&!isBundleProduct){localBundleData.splice(index,1);}}});localStorage.setItem('kaktusfBundleData',JSON.stringify(localBundleData));}}
if("/cart"===location.href.slice(-5)){const triggerType=triggerTypes.cartPage;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){fetchCart().then(function(dataCart){let variantsId='0',cart='0';if(dataCart.items.length){const targetProducts=dataCart.items.filter(item=>!!!item.properties||(item.properties&&!item.properties.offer));if(targetProducts.length){variantsId=targetProducts.map(item=>item.id);variantsId=variantsId.join();}
cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,variantsId,cart,cartValue:dataCart.total_price}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType)}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}})})}}
if(Object.keys(kaktusfCartButton).length>0&&Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(2)){let triggersString=decodeHTML(kaktusfCartButton);const kaktusfCartButtonArr=kaktusfCartButton.length?triggersString.split(','):[]
if(kaktusfCartButtonArr.length){const triggerType=triggerTypes.cartPage;kaktusfCartButtonArr.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){certainButtonsTrigger(currentTrigger,itemTrim,triggerType);}});}}
if("/thank_you"===location.href.slice(-10)||Shopify.checkout){const triggerType=triggerTypes.thankYouPage;const orderItems=Shopify.checkout.line_items;const offerData=JSON.parse(localStorage.getItem('kaktusfPurchaseData'));const totalPrice=Math.round(parseFloat(Shopify.checkout.total_price)*100);let cart=orderItems.map(item=>item.product_id);cart=cart.join();let variantsId=orderItems.map(item=>item.variant_id);variantsId=variantsId.join();sendPurchaseAPI(offerData,orderItems);localStorage.removeItem('kaktusDataOrder');if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){const offerParams={triggerType,cart,variantsId,cartValue:totalPrice}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){buildPopUpType(dataOffer,false,false,triggerType);}})}}
function sendPurchaseAPI(offerData,orderItems){if(!offerData){return}
offerData.forEach(mainOfferItem=>{const offerDataItem={'main_offer_id':mainOfferItem.main_offer_id,'offer_amount':[]}
mainOfferItem.offer.forEach(offerItem=>{const lineItemProperty=orderItems.find(item=>offerItem.property_id===item.properties.offer)
if(lineItemProperty){let discount;let qty=+lineItemProperty.quantity!==0?+lineItemProperty.quantity:1;if(lineItemProperty.applied_discounts.length>0&&lineItemProperty.applied_discounts[0].amount){discount=lineItemProperty.applied_discounts[0].amount;}
if(offerDataItem.offer_amount.length){const checkOfferId=offerDataItem.offer_amount.find(item=>item.offer_id===offerItem.offer_id);if(checkOfferId){checkOfferId.amount=(+checkOfferId.amount+(discount?(+offerItem.product_store_price*qty)-discount:+offerItem.product_store_price*qty)).toFixed(2);}else{offerDataItem.offer_amount.push({offer_id:offerItem.offer_id,amount:discount?((+offerItem.product_store_price*qty)-discount).toFixed(2):(+offerItem.product_store_price*qty).toFixed(2)});}}else{offerDataItem.offer_amount.push({offer_id:offerItem.offer_id,amount:discount?((+offerItem.product_store_price*qty)-discount).toFixed(2):(+offerItem.product_store_price*qty).toFixed(2)});}}})
if(offerDataItem.offer_amount.length){createPurchaseFetch(offerDataItem);}})
localStorage.removeItem('kaktusfPurchaseData');}
if(location.href.includes('/pages/')){const triggerType=triggerTypes.selectedPages;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){fetchPage(location.href).then(function(dataPage){const pageId=dataPage.page.id;if(kaktusfPageIds.includes(pageId)){fetchCart().then(function(dataCart){let cart='0',variantsId='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();variantsId=dataCart.items.map(item=>item.id);variantsId=variantsId.join();}
const offerParams={triggerType,cart,variantsId,cartValue:dataCart.total_price,targetCode:pageId}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}})})}})}}
if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(5)){if(kaktusfCertainBtns.length){const triggerType=triggerTypes.certainButtons;kaktusfCertainBtns.forEach(certainItem=>{if(certainItem.includes(',')){const itemArr=certainItem.split(',');itemArr.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){certainButtonsTrigger(currentTrigger,itemTrim,triggerType);}});}else{const itemTrim=certainItem.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){certainButtonsTrigger(currentTrigger,itemTrim,triggerType);}}});}}
function certainButtonsTrigger(currentTrigger,itemTrim,triggerType){currentTrigger.forEach(elem=>{elem.addEventListener("click",function(){getOfferButtons(itemTrim,triggerType);})});}
if(location.href.includes('/products/')){const triggerType=triggerTypes.productPage;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){let url=location.href.split('/');let productsIndex=url.indexOf('products');url=url[productsIndex+1];fetchProduct(url).then(function(dataPage){const productId=dataPage.product.id;fetchCart().then(function(dataCart){let cart='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,productId,cart,cartValue:dataCart.total_price}
if(location.href.includes('offerId')){offerFetchPrewiev(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){currentProductId='';dataPage.product.variants.forEach(variant=>{if(dataCart.items.length){const replacedProduct=dataCart.items.find(item=>item.id===variant.id);if(replacedProduct){currentProductId=variant.id;}}});const offerType=dataOffer.offers[Object.keys(dataOffer.offers)[0]].offer_type;if(offerType===offerTypes.fbt){let isProductInResp=dataOffer.products[productId];if(!isProductInResp){dataOffer.products[productId]=setTriggerProductToOffer(dataPage.product);const offerProducts=dataOffer.offers[Object.keys(dataOffer.offers)[0]].products;offerProducts.unshift([productId]);const offerDiscount=dataOffer.discount[Object.keys(dataOffer.discount)[0]];offerDiscount.unshift({discount:null,discount_type:null,min_qty:null,qty:0})}}
buildPopUpType(dataOffer,dataCart,false,triggerType);}});}else{offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){currentProductId='';dataPage.product.variants.forEach(variant=>{if(dataCart.items.length){const replacedProduct=dataCart.items.find(item=>item.id===variant.id);if(replacedProduct){currentProductId=variant.id;}}});const offerType=dataOffer.offers[Object.keys(dataOffer.offers)[0]].offer_type;if(offerType===offerTypes.fbt){let isProductInResp=dataOffer.products[productId];if(!isProductInResp){dataOffer.products[productId]=setTriggerProductToOffer(dataPage.product);const offerProducts=dataOffer.offers[Object.keys(dataOffer.offers)[0]].products;offerProducts.unshift([productId]);const offerDiscount=dataOffer.discount[Object.keys(dataOffer.discount)[0]];offerDiscount.unshift({discount:null,discount_type:null,min_qty:null,qty:0})}}
buildPopUpType(dataOffer,dataCart,false,triggerType);}});}});})}}
const exitIntent=e=>{const shouldShowExitIntent=!e.toElement&&!e.relatedTarget&&e.clientY<10;if(shouldShowExitIntent){document.removeEventListener('mouseout',exitIntent);const triggerType=triggerTypes.exitIntent;if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){fetchCart().then(function(dataCart){let cart='0',variantsId='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();variantsId=dataCart.items.map(item=>item.id);variantsId=variantsId.join();}
const offerParams={triggerType,cart,variantsId,cartValue:dataCart.total_price,}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}})})}else{return;}}};setTimeout(()=>{document.addEventListener('mouseout',exitIntent);},1000);if(document.location.pathname==="/"){const triggerType=triggerTypes.homePage;getOfferCommon(triggerType);}
if(location.href.includes('/collections/')){const triggerType=triggerTypes.collectionPage;getOfferCommon(triggerType);}
if(location.href.includes('/blogs/')){const triggerType=triggerTypes.blogPage;getOfferCommon(triggerType);}
if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(11)){let popupShow=isPopupShown();if(popupShow){const triggerType=triggerTypes.beforeCheckout;const defaultTriggers=['.cart__submit','input[name="checkout"]','button[name="checkout"]'];let triggersString=decodeHTML(kaktusfTriggerButton);const kaktusfTriggerButtonArr=kaktusfTriggerButton.length?triggersString.split(','):[];const commonTriggersArray=kaktusfTriggerButtonArr.concat(defaultTriggers);const uniqueArr=[...new Set(commonTriggersArray)];let clicked=false;document.addEventListener("click",function(e){uniqueArr.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){currentTrigger.forEach(elem=>{if(e.target===elem&&!clicked){e.preventDefault();e.stopImmediatePropagation();getOfferButtons(itemTrim,triggerType);clicked=true;setTimeout(()=>{clicked=false;},500);}});}})},true);}}
if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(12)){let popupShow=isPopupShown();if(popupShow){const triggerType=triggerTypes.buyItNow;let triggersString=decodeHTML(kaktusfbuyItNow);const kaktusfTriggerBuyItNow=kaktusfbuyItNow.length?triggersString.split(','):[];if(kaktusfTriggerBuyItNow.length){let clicked=false;document.addEventListener("click",function(e){let thisTarget=e.target;kaktusfTriggerBuyItNow.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){currentTrigger.forEach(elem=>{if(thisTarget===elem&&!clicked){e.preventDefault();e.stopImmediatePropagation();buyItNowTrigger(thisTarget,itemTrim,triggerType);clicked=true;setTimeout(()=>{clicked=false;},500);}});}})},true);}}}
function buyItNowTrigger(thisTarget,itemTrim,triggerType){let form=thisTarget.closest('form[action*="/cart/add"]');let data=new FormData(form);let formObj=serialize(data);function serialize(data){let obj={};for(let[key,value]of data){if(obj[key]!==undefined){if(!Array.isArray(obj[key])){obj[key]=[obj[key]];}
obj[key].push(value);}else{obj[key]=value;}}
return obj;}
let variantsId=0;let qty=1;let properties='';for(let key in formObj){if(key==='id'){variantsId=formObj[key];}else if(key==='quantity'){qty=formObj[key];}else if(key.includes('properties')){if(key.includes('[')){const result=key.replace(/(.+\[)(.+)(\])/ig,'$2');properties={[result]:formObj[key]}}else{properties=formObj[key];}}}
triggerProduct=true;addItem(variantsId,qty,properties).then(function(){fetchCart().then(dataCart=>{let productId=null;let cart='0';if(dataCart.items.length){const targetProduct=dataCart.items.find(item=>!!!item.properties||(item.properties&&!item.properties.offer)&&item.id==variantsId);productId=targetProduct?targetProduct.product_id:productId;cart=dataCart.items.map(item=>item.product_id);cart=cart.join();}
const offerParams={triggerType,productId,variantsId,cart,cartValue:dataCart.total_price,targetCode:itemTrim}
offerFetch(offerParams).then(dataOffer=>{if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}else{createOrder();}}).catch(error=>{console.error(error);createOrder();});});}).catch(error=>console.error(error));}
function getOfferCommon(triggerType){if(Object.keys(kaktusfTriggerEvents).length&&kaktusfTriggerEvents.includes(+triggerType)){fetchCart().then(function(dataCart){let cart='0',variantsId='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();variantsId=dataCart.items.map(item=>item.id);variantsId=variantsId.join();}
const offerParams={triggerType,cart,variantsId,cartValue:dataCart.total_price,}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}})})}else{return;}}
function getOfferButtons(itemTrim,triggerType){fetchCart().then(function(dataCart){let cart='0',variantsId='0';if(dataCart.items.length){cart=dataCart.items.map(item=>item.product_id);cart=cart.join();variantsId=dataCart.items.map(item=>item.id);variantsId=variantsId.join();}
const offerParams={triggerType,cart,variantsId,cartValue:dataCart.total_price,targetCode:itemTrim}
offerFetch(offerParams).then(function(dataOffer){if(typeof dataOffer.main_offer_id!='undefined'){if(dataCart.items.length){currentProductId=dataOffer.trigger_id!='any'?dataOffer.trigger_id:dataCart.items[0].id;buildPopUpType(dataOffer,dataCart,currentProductId,triggerType);}else{buildPopUpType(dataOffer,dataCart,false,triggerType);}}else{if(triggerType===triggerTypes.beforeCheckout)createOrder();}}).catch(error=>{console.error(error);if(triggerType===triggerTypes.beforeCheckout)createOrder();});})}
function getVariantImageSrc(imageId,product){if(!imageId){return product.image.src}
let image=product.images.find(item=>item.id===imageId);if(image){return image.src}else{return product.image.src}}
function setTriggerProductToOffer(product){const regex=/(<([^>]+)>)/ig;const variantsArr=[];for(let key in product.variants){let variantItem=product.variants[key];let imageSrc=getVariantImageSrc(variantItem.image_id,product);let variantObj={title:variantItem.title,description:product.body_html?(product.body_html).replace(regex,""):"",image:imageSrc,inventory_management:variantItem.inventory_management,productId:variantItem.id,variantPrice:kaktusfCurrencyCode!==currentCurrencyCode?getStorePriceByRate(variantItem.price):variantItem.price,}
variantsArr.push(variantObj);}
return{title:product.title,description:product.body_html?(product.body_html).replace(regex,""):"",image:product.image.src,inventory_management:product.variants[0].inventory_management,productId:product.id,variants:variantsArr,fbtTriggeredProduct:true}}!function(){let lastBtn=null
document.addEventListener('click',function(e){if(!e.target.closest)return;lastBtn=e.target.closest('button, input[type=submit]');},true);document.addEventListener('submit',function(e){if('submitter'in e)return;var canditates=[document.activeElement,lastBtn];lastBtn=null;for(var i=0;i<canditates.length;i++){var candidate=canditates[i];if(!candidate)continue;if(!candidate.form)continue;if(!candidate.matches('button, input[type=submit]'))continue;e.submitter=candidate;return;}
e.submitter=e.target.querySelector('button, input[type=submit]')},true);}();document.addEventListener("submit",function(e){if("string"==typeof e.target.action){if("/checkout"===e.target.action.slice(-9)||"/cart"===e.target.action.slice(-5)){const btnType=e.submitter.getAttribute('name');if(btnType&&btnType==='update')return;e.preventDefault();createOrder();}}});if(!!document.querySelector('a[href="/checkout"]')){document.querySelector('a[href="/checkout"]').addEventListener('click',function(e){e.preventDefault();createOrder();})}
if(kaktusfTriggerButton.length&&Object.keys(kaktusfTriggerEvents).length&&!kaktusfTriggerEvents.includes(11)){storeCheckoutEvent();}
function storeCheckoutEvent(){let triggersString=decodeHTML(kaktusfTriggerButton);const checkoutButtonArr=triggersString.split(',');let clicked=false;document.addEventListener("click",function(e){checkoutButtonArr.forEach(item=>{const itemTrim=item.trim();const currentTrigger=document.querySelectorAll(itemTrim);if(currentTrigger!=null){currentTrigger.forEach(elem=>{if(e.target===elem&&!clicked){e.preventDefault();e.stopImmediatePropagation();createOrder();clicked=true;setTimeout(()=>{clicked=false;},500);}});}})},true);}
async function createOrderFetch(dataCart,orderData){const options={method:'POST',headers:{'Content-Type':'application/json',"Accept":"application/json"},body:JSON.stringify(createOrderRequest(dataCart,orderData))};let url=kaktusfApiUrl+`api/front/draft-order`;const resp=await fetch(url,options);if(!resp.ok){throw new Error(`HTTP error, status = ${resp.status}`);}
return await resp.json();}
function createOrderRequest(dataCart,orderData){const domain=kaktusfShop;const line_items=[];let discount=null;let properties=null;dataCart.forEach(item=>{let qty=item.quantity;if(orderData){if(!!item.properties&&!!item.properties.offer){const lineItemProperty=orderData.find(prod=>prod.propertyId===item.properties.offer);if(lineItemProperty){discount=lineItemProperty.discountValue!=null?{value_type:lineItemProperty.discountType,value:+lineItemProperty.discountValue}:null;item.properties.offer=lineItemProperty.propertyId;properties=item.properties;qty=+lineItemProperty.qty;}}else{discount=null;properties=item.properties;}}
line_items.push({title:item.title,product_id:item.product_id,variant_id:item.variant_id,price:kaktusfCurrencyCode!==currentCurrencyCode?getStorePriceByRate(item.price / 1000)*1000:item.price,quantity:qty,discount:discount,properties:properties})
if(+item.quantity>+qty){let result=+item.quantity- +qty;item.properties.offer=null;line_items.push({title:item.title,product_id:item.product_id,variant_id:item.variant_id,price:kaktusfCurrencyCode!==currentCurrencyCode?getStorePriceByRate(item.price / 1000)*1000:item.price,quantity:result,discount:null,properties:item.properties})}})
return{domain:domain,line_items:line_items}}
function createOrderData(variantId,propertyId,discountType,discountValue,qty){const localOrderData=localStorage.getItem('kaktusDataOrder');orderData=localOrderData?JSON.parse(localOrderData):orderData;let productData={variantId:variantId,propertyId:propertyId,discountType:discountType,discountValue:discountValue,qty:qty}
if(productData.discountType!='%'&&discountValue!=null){productData.discountValue=(+discountValue /+window.Shopify.currency.rate).toFixed(2)}
orderData.push(productData);localStorage.setItem('kaktusDataOrder',JSON.stringify(orderData));}
function createOrder(){const modalBody=document.querySelector("#kaktusf-app");if(modalBody){getAppSelector('.kaktusf-popup__body').classList.add('kaktusf-preload');}
const line_items=[];fetchCart().then(function(dataCart){const orderData=JSON.parse(localStorage.getItem('kaktusDataOrder'));dataCart.items.forEach(item=>{if(orderData){if(!!item.properties&&!!item.properties.offer){const lineItemProperty=orderData.find(prod=>prod.propertyId===item.properties.offer);if(lineItemProperty){if(lineItemProperty.discountValue!=null){line_items.push(item);}}}}});if(line_items.length){createOrderFetch(dataCart.items,orderData).then(result=>{location.href=result.checkout;},error=>{location.href='/checkout';})}else{location.href='/checkout';}})}
function goToCart(){const modalBody=document.querySelector("#kaktusf-app");if(modalBody){getAppSelector('.kaktusf-popup__body').classList.add('kaktusf-preload');}
let domain=location.href.split('/');domain=domain[0]+'//'+domain[2];location.href=domain+'/cart';};function facebookPixel(){if(!facebookId){return;}else{!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init',facebookId);fbq('track','PageView');}}
function googleAnalytics(){if(!googleId){return;}else{(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create',googleId,'auto');ga('send','pageview');}}
function pinteresPixel(){if(!pinterestId){return;}else{!function(e){if(!window.pintrk){window.pintrk=function(){window.pintrk.queue.push(Array.prototype.slice.call(arguments))};var
n=window.pintrk;n.queue=[],n.version="3.0";var
t=document.createElement("script");t.async=!0,t.src=e;var
r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}}
("https://s.pinimg.com/ct/core.js");pintrk('load',pinterestId);pintrk('page');pintrk('track','pagevisit');}}
function snapPixel(){if(!snapId){return;}else{(function(win,doc,sdk_url){if(win.snaptr)return;var tr=win.snaptr=function(){tr.handleRequest?tr.handleRequest.apply(tr,arguments):tr.queue.push(arguments);};tr.queue=[];var s='script';var new_script_section=doc.createElement(s);new_script_section.async=!0;new_script_section.src=sdk_url;var insert_pos=doc.getElementsByTagName(s)[0];insert_pos.parentNode.insertBefore(new_script_section,insert_pos);})(window,document,'https://sc-static.net/scevent.min.js');snaptr('init',snapId,{'user_email':snapEmail})
snaptr('track','PAGE_VIEW');}}
function socialPixel(){facebookPixel();googleAnalytics();pinteresPixel();snapPixel();}
function isPopupShown(){const currentShownPerMonth=parseInt(getCookie('kaktusfCurrentShownPerMonth'));const currentShownPerDay=parseInt(getCookie('kaktusfCurrentShownPerDay'));if((parseInt(kaktusfShowPopupPerDay)>currentShownPerDay||parseInt(kaktusfShowPopupPerDay)===0)&&(parseInt(kaktusfShowPopupAllPeriod)>currentShownPerMonth||parseInt(kaktusfShowPopupAllPeriod)===0)){return true}else{return false}}
function increasePopupShown(){let currentShownPerMonth=parseInt(getCookie('kaktusfCurrentShownPerMonth'));let currentShownPerDay=parseInt(getCookie('kaktusfCurrentShownPerDay'));let kaktusfStartDatePerMonth=getCookie('kaktusfStartDatePerMonth');let kaktusfStartDatePerDay=getCookie('kaktusfStartDatePerDay');currentShownPerMonth++;currentShownPerDay++;let expireMonth=new Date(Date.parse(kaktusfStartDatePerMonth)+3600000*24*25);let expireDay=new Date(Date.parse(kaktusfStartDatePerDay)+3600000*24);setCookie('kaktusfCurrentShownPerMonth',currentShownPerMonth,{expires:expireMonth});setCookie('kaktusfCurrentShownPerDay',currentShownPerDay,{expires:expireDay});}
function createOffersData(mainOfferId){if(+kaktusfMaxShowOffer===0){localStorage.removeItem(`kaktusfOffersData`);return;}
let offersData=[];const localoffersData=localStorage.getItem('kaktusfOffersData');offersData=localoffersData?JSON.parse(localoffersData):offersData;let data={'main_offer_id':mainOfferId,'shown':1}
if(offersData.length){const checkMainOfferId=offersData.find(item=>item.main_offer_id===mainOfferId);if(checkMainOfferId){checkMainOfferId.shown=+checkMainOfferId.shown+1;}else{offersData.push(data);}}else{offersData.push(data);}
localStorage.setItem(`kaktusfOffersData`,JSON.stringify(offersData));}
function setExcludeOffers(){if(+kaktusfMaxShowOffer===0)return;const localoffersData=JSON.parse(localStorage.getItem('kaktusfOffersData'));if(localoffersData){const excludeOffersArr=localoffersData.filter(item=>+item.shown>=+kaktusfMaxShowOffer);if(excludeOffersArr){excludeOffersArr.forEach(item=>{if(excludeOffers.indexOf(item.main_offer_id)===-1){excludeOffers.push(item.main_offer_id)}});}}}
function getExcludeCartOffer(){const offerId=localStorage.getItem(`kaktusfExcludeCartOfferId`);if(!offerId)return;excludeOffers.push(offerId);localStorage.removeItem(`kaktusfExcludeCartOfferId`);}
function cartReload(){if(cartOfferExcludeId){localStorage.setItem(`kaktusfExcludeCartOfferId`,cartOfferExcludeId);}
location.reload();}
class ProductPreview{constructor(product,activeProduct){this.template=this.setTemplate(product,activeProduct);this.body=document.querySelector("body");this.closeButton=this.template.querySelector('.kaktusf-product-det__close');this.qtyMinusBtn=this.template.querySelector('.kaktusf-product-det__qty--minus');this.qtyPlusBtn=this.template.querySelector('.kaktusf-product-det__qty--plus');this.qtyInput=this.template.querySelector('.kaktusf-product-det__qty--input');this.variationSelect=this.template.querySelector('.kaktusf-product-det__variations-select');this.sliderPrevBtn=this.template.querySelector('.kaktusf-product-det__prev');this.sliderNextBtn=this.template.querySelector('.kaktusf-product-det__next');this.addToCartBtn=this.template.querySelector('.kaktusf-cart-btn');this.removeBtn=this.template.querySelector('.kaktusf-remove-btn');this.activeProduct=activeProduct;this.init();};getActiveProductData(activeProduct){const showQty=activeProduct.querySelector('.kaktusf-qty')?activeProduct.querySelector('.kaktusf-qty').classList.contains('kaktusf-hide'):true;const qtyVal=activeProduct.querySelector('.kaktusf-qty-input')?activeProduct.querySelector('.kaktusf-qty-input').value:null;const activeVariant=activeProduct.querySelector('.kaktusf-variations')?activeProduct.querySelector('.kaktusf-variations').value:null;const showButtons=activeProduct.querySelector('.kaktusf-cart-btn')?true:false;const showAddToCartBtn=showButtons?activeProduct.querySelector('.kaktusf-cart-btn').classList.contains('kaktusf-hide'):null;const addToCartBtnText=showButtons?activeProduct.querySelector('.kaktusf-cart-btn-text').innerText:null;const removeBtnText=showButtons?activeProduct.querySelector('.kaktusf-remove-btn-text').innerText:null;const addedVariants=[];if(activeProduct.querySelector('.kaktusf-variations')){const varianOptions=activeProduct.querySelectorAll('.kaktusf-variations option');varianOptions.forEach(option=>{const added=option.getAttribute('data-added');if(added==='true'){addedVariants.push(parseInt(option.value));}});}
let data={show_qty:!showQty,qty_val:qtyVal,active_variant:activeVariant,show_buttons:showButtons,is_product_added:showAddToCartBtn,add_to_cart_text:addToCartBtnText,remove_text:removeBtnText,added_variants:addedVariants}
return data;}
setTemplate(product,activeProduct){let activeProductData=this.getActiveProductData(activeProduct);let productImg=noImage;if(product.image!=undefined){productImg=`<img src="${product.image}" alt="${product.title}">`;}
let productPrice='';let comparePrice='';let minQty=product.min_quantity?product.min_quantity:1;let imagesArr=[];let variantsHtml='';if(product.variants.length>1){variantsHtml=`<select class="kaktusf-product-det__variations-select">`;for(let key in product.variants){let variantPrice=getPriceByRate(product.variants[key]['variantPrice']);if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){variantPrice=calcVariantsDiscountPrice(product,product.variants[key]);}
let selectedOption='';if(parseInt(activeProductData.active_variant)===parseInt(product.variants[key]['productId'])){selectedOption='selected';productPrice=getPriceByRate(product.variants[key]['variantPrice']);}
let isVariantAdded=false;if((activeProductData.added_variants).includes(product.variants[key]['productId'])){isVariantAdded=true;}
variantsHtml+=`
                            <option
                                ${selectedOption}
                                value="${product.variants[key]['productId']}"
                                data-price="${getPriceByRate(product.variants[key]['variantPrice'])}"
                                data-compare-price="${getPriceByRate(product.variants[key]['variantComparePrice'])}"
                                data-diccounted-price="${variantPrice}"
                                data-variant-id="${product.variants[key]['productId']}"
                                data-added="${isVariantAdded}"
                            >
                                ${product.variants[key]['title']} - ${currencyFormat(variantPrice)}
                            </option>
                        `;if(imagesArr.length){let isAdded=imagesArr.find(item=>item.img===product.variants[key].image);if(isAdded){isAdded.ids.push(product.variants[key]['productId'])}else{imagesArr.push({img:product.variants[key].image,ids:[product.variants[key]['productId']]})}}else{imagesArr.push({img:product.variants[key].image,ids:[product.variants[key]['productId']]})}}
variantsHtml+='</select>';}else{variantsHtml='';productPrice=getPriceByRate(product.variants[0].variantPrice);}
let qtyHtml='';if(activeProductData.show_qty){qtyHtml=`
                        <div class="kaktusf-product-det__qty">
                            <div class="kaktusf-product-det__qty--minus">-</div>
                            <input class="kaktusf-product-det__qty--input" type="number" value="${activeProductData.qty_val}" min="${minQty}">
                            <div class="kaktusf-product-det__qty--plus">+</div>
                        </div>
                    `;}
if(product.discount!=undefined&&product.discount_type!=undefined&&parseInt(product.discount)!=0){let discountVal=product.discount_type!=="%"?getPriceByRate(product.discount):product.discount;comparePrice=`<span class="kaktusf-product-det__price-compare" data-discount="${discountVal}" data-discountType="${product.discount_type}">${currencyFormat(productPrice)}</span>`;if(product.discount_type==="%"){productPrice=(+productPrice-(+productPrice*+product.discount / 100));}else{productPrice=(+productPrice- +discountVal);}}
productPrice=currencyFormat(productPrice);if(imagesArr.length){if(imagesArr.length>1){let sliderImages='';imagesArr.forEach((item,i)=>{let active=item.ids.includes(parseInt(activeProductData.active_variant))?'kaktusf-slide-active':'';sliderImages+=`<div class="kaktusf-product-det__slider-item kaktusf-fade ${active}" data-image-id="${item.ids.join(',')}"><img src="${item.img}" alt="${product.title}"></div>`;});productImg=`
                            <div class="kaktusf-product-det__slider">
                                <button class="kaktusf-product-det__prev"><svg width="14px" height="14px" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M229.9 473.899l19.799-19.799c4.686-4.686 4.686-12.284 0-16.971L94.569 282H436c6.627 0 12-5.373 12-12v-28c0-6.627-5.373-12-12-12H94.569l155.13-155.13c4.686-4.686 4.686-12.284 0-16.971L229.9 38.101c-4.686-4.686-12.284-4.686-16.971 0L3.515 247.515c-4.686 4.686-4.686 12.284 0 16.971L212.929 473.9c4.686 4.686 12.284 4.686 16.971-.001z"></path></svg></button>
                                 ${sliderImages}
                                <button class="kaktusf-product-det__next"><svg fill="currentColor" width="14px" height="14px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M218.101 38.101L198.302 57.9c-4.686 4.686-4.686 12.284 0 16.971L353.432 230H12c-6.627 0-12 5.373-12 12v28c0 6.627 5.373 12 12 12h341.432l-155.13 155.13c-4.686 4.686-4.686 12.284 0 16.971l19.799 19.799c4.686 4.686 12.284 4.686 16.971 0l209.414-209.414c4.686-4.686 4.686-12.284 0-16.971L235.071 38.101c-4.686-4.687-12.284-4.687-16.97 0z"></path></svg></button>
                            </div>
                        `;}else{productImg=`<img src="${imagesArr[0].img}" alt="${product.title}">`;}}
let buttonsHtml='';if(activeProductData.show_buttons){buttonsHtml=`
                        <div class="kaktusf-product-det__btn">
                            <a href="#" class="kaktusf-cart-btn ${activeProductData.is_product_added ? 'kaktusf-hide' : ''}">
                                <svg class="kaktusf-product-icon" xmlns="http://www.w3.org/2000/svg" width="19" height="20"
                                    viewBox="0 0 19 20">
                                    <g>
                                        <g>
                                            <g>
                                                <path fill="inherit"
                                                    d="M7.126 10h-.754c-.126 0-.227-.052-.252-.138l-1.887-4.62c-.05-.12.076-.242.252-.242h1.082a.35.35 0 0 1 .276.138l1.535 4.62c.05.12-.076.242-.252.242zm9.036 1.487l2.767-6.474c.279-.651-.299-1.322-1.115-1.322H3.702L2.906.553A.74.74 0 0 0 2.209 0H.24A.229.229 0 0 0 0 .237v.987c0 .138.1.237.239.237h1.234c.12 0 .199.078.239.177l3.204 12.81a.74.74 0 0 0 .697.552h10.45c.14 0 .239-.099.239-.237v-.967c0-.138-.1-.237-.24-.237H6.37c-.1 0-.199-.079-.238-.177l-.299-1.224h9.196c.517 0 .955-.276 1.134-.671z" />
                                            </g>
                                            <g>
                                                <path fill="inherit"
                                                    d="M7.913 20c.875 0 1.584-.672 1.584-1.5S8.787 17 7.913 17c-.874 0-1.583.672-1.583 1.5S7.039 20 7.913 20z" />
                                            </g>
                                            <g>
                                                <path fill="inherit"
                                                    d="M13.193 20c.875 0 1.584-.672 1.584-1.5s-.71-1.5-1.584-1.5c-.874 0-1.583.672-1.583 1.5s.709 1.5 1.583 1.5z" />
                                            </g>
                                        </g>
                                    </g>
                                </svg>

                                <span class="kaktusf-cart-btn-text">${activeProductData.add_to_cart_text}</span>
                            </a>

                            <a href="#" class="kaktusf-remove-btn ${activeProductData.is_product_added ? '' : 'kaktusf-hide'}">
                                <svg class="kaktusf-product-icon" width="22px" height="20px"
                                    aria-hidden="true" focusable="false" data-prefix="fas" data-icon="trash-alt"
                                    role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                    <path fill="currentColor"
                                        d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z">
                                    </path>
                                </svg>

                                <span class="kaktusf-remove-btn-text">${activeProductData.remove_text}</span>
                            </a>
                        </div>
                    `;}
const description=product.description_html?`<div class="kaktusf-product-det__description">${product.description_html}</div>`:`<p class="kaktusf-product-det__description">${product.description}</p>`;const html=`
                    <div class="kaktusf-product-det__wrap">
                        <div class="kaktusf-product-det__body">
                            <div class="kaktusf-product-det__close">
                                <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" width="20" height="20"
                                    class="svg-inline--fa fa-times fa-kaktusf-11" role="img" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 352 512">
                                    <path fill="currentColor"
                                        d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z">
                                    </path>
                                </svg>
                            </div>

                            <div class="kaktusf-product-det__images">
                                ${productImg}
                            </div>
                            <div class="kaktusf-product-det__content">
                                <h2 class="kaktusf-product-det__title">${product.title}</h2>

                                <div class="kaktusf-product-det__price">
                                    ${comparePrice}
                                    <span class="kaktusf-product-det__price-main">${productPrice}</span>
                                </div>

                                ${description}

                                <div class="kaktusf-product-det__variations">
                                    ${variantsHtml}
                                </div>

                                <div class="kaktusf-product-det__bottom">
                                    ${qtyHtml}
                                    ${buttonsHtml}
                                </div>
                            </div>
                        </div>
                    </div>
                `;const element=document.createElement("div");element.classList.add("kaktusf-product-det__modal");element.innerHTML=html;return element;}
init(){this.closeButton.addEventListener('click',this.hide.bind(this));if(this.qtyInput){const activeProductInput=this.activeProduct.querySelector('.kaktusf-qty-input');this.qtyPlusBtn.addEventListener('click',e=>{e.preventDefault();changeQtyValue(this.qtyInput,'add',maxQty);changeQtyValue(activeProductInput,'add',maxQty);});this.qtyMinusBtn.addEventListener('click',e=>{e.preventDefault();changeQtyValue(this.qtyInput,'sub',maxQty);changeQtyValue(activeProductInput,'sub',maxQty);});this.qtyInput.addEventListener('change',e=>{e.preventDefault();changeQtyValue(this.qtyInput,'change',maxQty);changeQtyValue(activeProductInput,'change',maxQty);});}
if(this.variationSelect){let _this=this;this.variationSelect.addEventListener("change",function(e){e.preventDefault();const activeOption=this.selectedOptions[0];const element=this.closest('.kaktusf-product-det__body');if(_this.addToCartBtn){_this.addToCartBtn.setAttribute('data-productId',this.value);}
_this.changeVariant(element,activeOption);const activeProductVariationSelect=_this.activeProduct.querySelector('.kaktusf-variations');activeProductVariationSelect.value=this.value;if("createEvent"in document){let evt=document.createEvent("HTMLEvents");evt.initEvent("change",false,true);activeProductVariationSelect.dispatchEvent(evt);}
else{activeProductVariationSelect.fireEvent("onchange");}});}
if(this.sliderPrevBtn&&this.sliderNextBtn){this.sliderPrevBtn.addEventListener('click',this.changeSlider.bind(this,'prev'));this.sliderNextBtn.addEventListener('click',this.changeSlider.bind(this,'next'));}
if(this.addToCartBtn){this.addToCartBtn.addEventListener('click',e=>{e.preventDefault();this.addProduct();});}
if(this.removeBtn){this.removeBtn.addEventListener('click',e=>{e.preventDefault();this.removeProduct();});}
return this;}
show(){this.body.append(this.template);}
hide(){restartTimer();this.template.remove();}
changeActiveImg(elements,activeElement){elements.forEach(element=>element.classList.remove('kaktusf-slide-active'));activeElement.classList.add('kaktusf-slide-active');}
changeVariant(element,activeOption){const comparePriceContainer=element.querySelector(".kaktusf-product-det__price-compare");const mainPriceContainer=element.querySelector(".kaktusf-product-det__price-main");const price=activeOption.getAttribute('data-price');const variantId=activeOption.getAttribute('data-variant-id');let newPrice=price;if(comparePriceContainer){const discountValue=comparePriceContainer.getAttribute("data-discount");const discountType=comparePriceContainer.getAttribute("data-discountType");if(discountType==="%"){newPrice=(+price-(+price*+discountValue / 100)).toFixed(2);}else{newPrice=(+price- +discountValue).toFixed(2);}
comparePriceContainer.innerText=currencyFormat(price);}
mainPriceContainer.innerText=currencyFormat(newPrice)
let sliderItems=element.querySelectorAll('.kaktusf-product-det__slider-item');if(sliderItems){sliderItems.forEach(item=>{const imageIds=item.getAttribute('data-image-id').split(',');if(imageIds.includes(variantId)){this.changeActiveImg(sliderItems,item);}})}
const inCart=activeOption.getAttribute('data-added');if(inCart&&inCart==='true'){if(this.addToCartBtn&&this.removeBtn){this.addToCartBtn.classList.add('kaktusf-hide');this.removeBtn.classList.remove('kaktusf-hide');}}else{if(this.addToCartBtn&&this.removeBtn){this.addToCartBtn.classList.remove('kaktusf-hide');this.removeBtn.classList.add('kaktusf-hide');}}}
changeSlider(type){let sliderItems=document.querySelectorAll('.kaktusf-product-det__slider-item');let activeSlide;let activeSlideNumber;sliderItems.forEach((item,i)=>{if(item.classList.contains('kaktusf-slide-active')){activeSlide=item;activeSlideNumber=i;}});activeSlide.classList.remove('kaktusf-slide-active');let newActiveSlide=activeSlide;for(let i=0;i<sliderItems.length;i++){switch(type){case'next':{newActiveSlide=activeSlideNumber+1;if(newActiveSlide>=sliderItems.length){newActiveSlide=0;}
break}
case'prev':{newActiveSlide=activeSlideNumber-1;if(newActiveSlide<0){newActiveSlide=sliderItems.length-1;}
break}}
if(newActiveSlide===i){sliderItems[i].classList.add('kaktusf-slide-active');}}}
addProduct(){this.addToCartBtn.classList.add('kaktusf-preload');const activeProductAddBtn=this.activeProduct.querySelector('.kaktusf-cart-btn');activeProductAddBtn.click();setTimeout(()=>{this.addToCartBtn.classList.remove('kaktusf-preload');this.addToCartBtn.classList.add('kaktusf-hide');this.removeBtn.classList.remove('kaktusf-hide');setTimeout(()=>{restartTimer();this.template.remove();},1000);},1000);}
removeProduct(){const variantId=this.addToCartBtn.getAttribute('data-productid');this.removeBtn.classList.add('kaktusf-preload');const activeProductRemoveBtn=this.activeProduct.querySelector('.kaktusf-remove-btn');activeProductRemoveBtn.click();setTimeout(()=>{this.removeBtn.classList.remove('kaktusf-preload');this.removeBtn.classList.add('kaktusf-hide');this.addToCartBtn.classList.remove('kaktusf-hide');if(this.variationSelect){this.setVariantAddedToCart(variantId,false);}},1000);}
setVariantAddedToCart(variantId,param){const varianOptions=this.variationSelect.querySelectorAll('option');varianOptions.forEach(option=>{const optionValue=parseInt(option.value);if(parseInt(variantId)===optionValue){option.setAttribute('data-added',param);}});}}
function previewProductEvents(element,product){const previewOpenerImg=element.querySelector('.kaktusf-product__img');const previewOpenerTitle=element.querySelector('.kaktusf-prod-title');previewOpenerTitle.addEventListener("click",function(e){e.preventDefault();let detailModal=new ProductPreview(product,element);detailModal.show();clearInterval(countDown);});previewOpenerImg.addEventListener("click",function(e){e.preventDefault();let detailModal=new ProductPreview(product,element);detailModal.show();clearInterval(countDown);});return true;}
function previewProductEventsFBT(element,product){const previewOpenerTitle=element.querySelector('.kaktusf-prod-title');previewOpenerTitle.addEventListener("click",function(e){e.preventDefault();let detailModal=new ProductPreview(product,element);detailModal.show();clearInterval(countDown);});return true;}
function removeShopifyForm(){const forms=document.querySelectorAll('form[action*="/cart/add"]');forms.forEach(node=>node.remove());}};kaktusfApp();}